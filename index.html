<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式Web应用：大模型一览</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Linear App Inspired (Light Gray, Deep Indigo, Slate) -->
    <!-- Application Structure Plan: A single-page application with a fixed sidebar for thematic navigation. This non-linear structure encourages exploration over passive reading. Interactive modules within each section (timeline, diagrams, charts) are designed to make abstract concepts tangible and improve user understanding and engagement, which is superior to the original linear document format. -->
    <!-- Visualization & Content Choices: [Evolution -> Goal: Show change -> Viz: Interactive Timeline -> Interaction: Click to reveal -> Justification: More engaging than a list.], [Vectors -> Goal: Show relationships -> Viz: Chart.js Scatter Plot -> Interaction: Click to plot -> Justification: Visually demonstrates semantic distance.], [Attention -> Goal: Explain core concept -> Viz: HTML/CSS Diagram -> Interaction: Hover to show connections -> Justification: Makes the abstract "attention" concept concrete.], [Training/Inference -> Goal: Show processes -> Viz: Step-by-step animations -> Interaction: Auto-play or click-through -> Justification: Clarifies complex, dynamic processes.] -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #F9FAFB;
            color: #1F2937;
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            color: #4B5563;
        }
        .nav-link.active {
            background-color: #EEF2FF;
            color: #4338CA;
            font-weight: 600;
        }
        .nav-link:hover:not(.active) {
            background-color: #F3F4F6;
        }
        .content-section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -31px;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background-color: #F9FAFB;
            border: 3px solid #C7D2FE;
            transition: all 0.3s ease;
        }
        .timeline-item.active::before {
            background-color: #4338CA;
            border-color: #4338CA;
        }
        /* 时间轴箭头样式 */
        #timeline-nav::before {
            content: '';
            position: absolute;
            left: -2px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #A5B4FC, #6366F1);
        }
        #timeline-nav::after {
            content: '';
            position: absolute;
            left: -8px;
            bottom: -8px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 12px solid #6366F1;
        }
        .attention-word {
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .attention-word.active {
            background-color: #4338CA;
            color: white;
            border-radius: 0.375rem;
        }
        .attention-word.target {
             text-shadow: 0 0 15px rgba(67, 56, 202, 0.7);
        }
        .attention-line {
            position: absolute;
            background-color: #6366F1;
            transform-origin: left center;
            transition: all 0.4s ease-out;
            opacity: 0;
            z-index: -1;
        }
        .kv-cache-item {
            transition: all 0.5s ease;
            opacity: 0;
            transform: translateX(-20px);
        }
        .arch-diagram {
            border: 1px solid #E5E7EB;
            padding: 1rem;
            border-radius: 0.75rem;
            background-color: white;
        }
        .arch-box {
            border: 1px solid #C7D2FE;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            text-align: center;
            font-weight: 500;
            background-color: #EEF2FF;
            color: #3730A3;
        }
        .arch-component {
            border: 1px solid #C7D2FE;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .arch-arrow {
            font-size: 2rem;
            color: #A5B4FC;
            line-height: 1;
        }
        .math-box {
            font-family: monospace;
            background-color: #F3F4F6;
            padding: 0.5rem;
            border-radius: 0.25rem;
            display: inline-block;
            letter-spacing: 1px;
            border: 1px solid #E5E7EB;
        }
        .journey-step {
            padding: 2rem;
            border-left: 2px solid #E5E7EB;
            position: relative;
        }
        .journey-step::before {
            content: attr(data-step);
            position: absolute;
            left: -21px;
            top: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #4338CA;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
            border: 4px solid #F9FAFB;
        }
        /* 训练步骤相关样式 */
        .training-step {
            opacity: 0.3;
            transform: translateX(-20px);
            transition: all 0.8s ease;
        }
        .training-step.active {
            opacity: 1;
            transform: translateX(0);
        }
        .training-step.completed {
            opacity: 0.7;
        }
        .vector-animation {
            transition: all 0.5s ease;
        }
        .vector-animation.highlight {
            background-color: #4338CA;
            color: white;
            transform: scale(1.05);
        }
        .vector-bar {
            border-radius: 2px;
            min-height: 2px;
        }
        .math-element {
            padding: 2px 4px;
            border-radius: 4px;
            background-color: #F3F4F6;
        }
        .attention-bar {
            border-radius: 6px;
        }
        .softmax-visual {
            transition: all 0.8s ease;
        }
        .weight-display {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.5s ease;
        }
        
        /* 响应式媒体查询 */
        @media (max-width: 640px) {
            /* 移动端字体缩放 */
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.75rem; }
            h3 { font-size: 1.25rem; }
            h4 { font-size: 1.125rem; }
            
            /* 移动端内边距调整 */
            .p-6 { padding: 1rem; }
            .p-8 { padding: 1.5rem; }
            .p-12 { padding: 1.5rem; }
            
            /* 移动端侧边栏宽度调整 */
            #sidebar {
                width: 256px; /* 对应 w-64 */
            }
            
            /* 移动端图表容器 */
            .chart-container {
                height: 250px;
                max-width: 100%;
            }
            
            /* 移动端按钮优化 */
            button {
                min-height: 44px;
                padding: 0.75rem 1rem;
            }
            
            /* 移动端时间轴调整 */
            .timeline-item {
                padding-left: 2rem;
            }
            
            .timeline-item::before {
                left: -15px;
                width: 16px;
                height: 16px;
            }
            
            /* 移动端架构图调整 */
            .arch-arrow {
                font-size: 1.5rem;
            }
            
            .arch-component {
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }
            
            /* 移动端数学公式调整 */
            .math-box {
                font-size: 0.8rem;
                padding: 0.375rem;
            }
            
            /* 移动端向量动画调整 */
            .vector-bar {
                min-height: 3px;
            }
            
            /* 移动端权重显示调整 */
            .weight-display {
                font-size: 1.25rem;
                padding: 0.375rem;
            }
        }
        
        @media (min-width: 641px) and (max-width: 768px) {
            /* 平板端优化 */
            h2 { font-size: 2.5rem; }
            
            .chart-container {
                height: 300px;
            }
            
            #sidebar {
                width: 256px; /* 对应 md:w-64 */
            }
            
            button {
                min-height: 42px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            /* 小桌面端优化 */
            .chart-container {
                height: 320px;
            }
        }
        
        @media (min-width: 1025px) {
            /* 大桌面端优化 */
            .chart-container {
                height: 400px;
                max-width: 700px;
            }
            
            /* 大屏幕下增加内容最大宽度 */
            main {
                max-width: 1200px;
            }
        }
        
        /* 触控设备优化 */
        @media (hover: none) and (pointer: coarse) {
            /* 增加触控目标大小 */
            .nav-link {
                min-height: 48px;
                display: flex;
                align-items: center;
            }
            
            button, .nav-link, .attention-word {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* 优化触控反馈 */
            .attention-word:active {
                transform: scale(0.95);
            }
            
            button:active {
                transform: scale(0.98);
            }
        }
        
        /* 高对比度模式支持 */
        @media (prefers-contrast: high) {
            .nav-link {
                border: 2px solid transparent;
            }
            
            .nav-link.active {
                border-color: #4338CA;
            }
            
            .arch-component, .arch-box {
                border-width: 2px;
            }
        }
        
        /* 减少动画模式支持 */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* 防止侧边栏遮盖内容的额外保护 */
        @media (min-width: 768px) {
            main {
                margin-left: 256px; /* 确保与侧边栏宽度一致 */
            }
            
            #sidebar {
                width: 256px !important; /* 强制固定宽度 */
            }
        }
        
        /* 移动端确保侧边栏完全隐藏 */
        @media (max-width: 767px) {
            #sidebar {
                transform: translateX(-100%);
            }
            
            #sidebar.show {
                transform: translateX(0);
            }
            
            main {
                margin-left: 0 !important;
            }
        }
    </style>
</head>
<body class="antialiased">
    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="w-64 bg-white/90 backdrop-blur-sm border-r border-gray-200 p-4 sm:p-6 fixed h-full transition-all duration-300 z-20 shadow-lg md:shadow-none">
            <h1 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 sm:mb-8">大模型速览</h1>
            <nav id="nav-menu" class="space-y-1">
                <a href="#intro" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">引言</a>
                <a href="#evolution" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">演进之路</a>
                <a href="#vectors" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">核心基石：向量</a>
                <a href="#transformer" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">核心引擎：Transformer</a>
                <a href="#training" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">训练概述</a>
                <a href="#decoder-arch" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">解码器架构</a>
                <a href="#decoder-journey" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">向量的深度之旅</a>
                <a href="#inference" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">推理过程</a>
                <a href="#illusion" class="nav-link block p-3 rounded-md text-base sm:text-lg transition-all">智能的幻象</a>
            </nav>
        </aside>

        <!-- Mobile Header -->
        <header class="md:hidden fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-sm p-4 z-30 border-b border-gray-200 flex justify-between items-center shadow-sm">
            <h1 class="text-lg sm:text-xl font-bold text-gray-800">大模型速览</h1>
            <button id="menu-toggle" class="text-2xl text-gray-600 p-2 rounded-md hover:bg-gray-100 transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center">☰</button>
        </header>

        <!-- Main Content -->
        <main class="flex-1 p-4 sm:p-6 md:p-8 lg:p-12 pt-20 md:pt-12">
            <div class="max-w-none lg:max-w-4xl xl:max-w-5xl mx-auto">
            
            <section id="intro" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-4 text-[#4338CA]">思考：大模型真的能理解文字吗？</h2>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="space-y-6">
                        <p class="text-lg sm:text-xl leading-relaxed text-gray-700">我们每天都在与大型语言模型（LLM）互动，惊叹于它们强大的对话、创作乃至推理能力。</p>
                        <p class="text-lg sm:text-xl leading-relaxed text-gray-700">这引出了一个根本性的问题：当模型翻译一句复杂的诗歌，或解决一道棘手的数学题时，它是在进行真正的"思考"吗？</p>
                        <blockquote class="border-l-4 border-[#6366F1] pl-4 italic text-xl sm:text-2xl text-gray-800">
                            它是否真的像人类一样“理解”了文字背后的含义？
                        </blockquote>
                    </div>
                    <div class="flex items-center justify-center p-4 sm:p-8">
                        <div class="w-48 h-48 sm:w-56 sm:h-56 md:w-64 md:h-64 bg-white rounded-full flex items-center justify-center shadow-lg relative">
                            <div class="text-6xl sm:text-7xl md:text-8xl animate-pulse text-indigo-400">?</div>
                            <div class="absolute w-full h-full border-2 sm:border-4 border-indigo-200 rounded-full animate-ping"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="evolution" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-6 sm:mb-8 text-[#4338CA]">演进之路：机器翻译的技术变迁</h2>
                <p class="text-lg sm:text-xl leading-relaxed mb-6 sm:mb-8 text-gray-700">今天我们所熟知的大模型，并非凭空出现。它深深植根于<strong>自然语言处理（NLP）</strong>数十年的探索，并由<strong>神经网络</strong>技术引爆。可以说，<strong>NLP的发展史，就是大模型的演进史</strong>。让我们以"机器翻译"这个NLP领域的经典难题为线索，见证这场伟大的技术变革。</p>
                <!-- 挑战示例 -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 sm:p-6 rounded-xl shadow-sm border border-blue-200 mb-6 sm:mb-8">
                    <h3 class="text-xl sm:text-2xl font-semibold mb-4 text-center text-blue-800">🎯 贯穿始终的翻译挑战</h3>
                    <div class="grid md:grid-cols-2 gap-4 sm:gap-6">
                        <div class="bg-white p-3 sm:p-4 rounded-lg border border-blue-100">
                            <h4 class="font-bold text-blue-700 mb-2">英文原句</h4>
                            <p class="font-mono text-lg text-blue-800">"The cat sat on the mat"</p>
                </div>
                        <div class="bg-white p-3 sm:p-4 rounded-lg border border-green-100">
                            <h4 class="font-bold text-green-700 mb-2">期望中文</h4>
                            <p class="font-mono text-base sm:text-lg text-green-800">"猫坐在垫子上"</p>
                            </div>
                            </div>
                    <p class="text-center text-sm text-blue-600 mt-4">看似简单的句子，却包含了词汇翻译、语法转换、语序调整等多重挑战</p>
                            </div>
                <!-- 演进阶段导航 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-center">🚀 技术演进路线图</h3>
                    <div class="flex flex-wrap justify-center gap-3">
                        <button class="evolution-stage-btn bg-red-100 hover:bg-red-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-red-300 font-semibold text-red-700 transition min-h-[44px] text-sm sm:text-base" data-stage="rule-based" onclick="showEvolutionStage('rule-based')">
                            📋 规则驱动 (1950s-1980s)
                        </button>
                        <button class="evolution-stage-btn bg-orange-100 hover:bg-orange-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-orange-300 font-semibold text-orange-700 transition min-h-[44px] text-sm sm:text-base" data-stage="statistical" onclick="showEvolutionStage('statistical')">
                            📊 统计革命 (1990s-2000s)
                        </button>
                        <button class="evolution-stage-btn bg-green-100 hover:bg-green-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-green-300 font-semibold text-green-700 transition min-h-[44px] text-sm sm:text-base" data-stage="neural" onclick="showEvolutionStage('neural')">
                            🧠 神经网络 (2010s)
                        </button>
                        <button class="evolution-stage-btn bg-blue-100 hover:bg-blue-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-blue-300 font-semibold text-blue-700 transition min-h-[44px] text-sm sm:text-base" data-stage="attention" onclick="showEvolutionStage('attention')">
                            👁️ 注意力机制 (2014-2016)
                        </button>
                        <button class="evolution-stage-btn bg-purple-100 hover:bg-purple-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-purple-300 font-semibold text-purple-700 transition min-h-[44px] text-sm sm:text-base" data-stage="transformer" onclick="showEvolutionStage('transformer')">
                            🚀 Transformer (2017至今)
                        </button>
                            </div>
                            </div>

                <!-- 第一阶段：规则驱动 -->
                <div id="stage-rule-based" class="evolution-stage">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-4 sm:mb-6 text-red-700">📋 第一阶段：规则驱动 (1950s-1980s)</h3>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- 核心思想 -->
                            <div class="space-y-6">
                                <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                                    <h4 class="text-xl font-bold text-red-700 mb-4">💡 核心思想</h4>
                                    <p class="text-red-600 mb-4">让语言学家制定详尽的翻译规则，机器严格按规则执行</p>
                                    <div class="bg-white p-4 rounded border border-red-100">
                                        <h5 class="font-bold text-red-700 mb-2">典型规则示例：</h5>
                                        <ul class="text-sm text-red-600 space-y-1">
                                            <li>• "The" + 名词 → "这" + 名词</li>
                                            <li>• 动词 + "on" + 名词 → 动词 + "在" + 名词 + "上"</li>
                                            <li>• 英语SVO → 中文SVO</li>
                                        </ul>
                        </div>
                    </div>

                                <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                                    <h4 class="text-xl font-bold text-yellow-700 mb-4">⚠️ 主要局限</h4>
                                    <ul class="text-yellow-600 space-y-2">
                                        <li>• <strong>规则爆炸：</strong>语言例外太多，规则无法穷举</li>
                                        <li>• <strong>上下文缺失：</strong>无法处理歧义和语境</li>
                                        <li>• <strong>维护困难：</strong>新规则可能与旧规则冲突</li>
                                        <li>• <strong>缺乏灵活性：</strong>无法适应语言的自然变化</li>
                                    </ul>
                        </div>
                            </div>

                            <!-- 翻译演示 -->
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-red-100 to-pink-100 p-6 rounded-lg border border-red-200">
                                    <h4 class="text-xl font-bold text-red-700 mb-4">🔧 翻译过程演示</h4>
                                    <div class="space-y-4">
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 1: 词汇查找</div>
                                            <div class="grid grid-cols-2 gap-2 text-sm">
                                                <div class="font-mono">The → 这</div>
                                                <div class="font-mono">cat → 猫</div>
                                                <div class="font-mono">sat → 坐</div>
                                                <div class="font-mono">on → 在...上</div>
                                                <div class="font-mono">the → 这</div>
                                                <div class="font-mono">mat → 垫子</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 2: 语法规则应用</div>
                                            <div class="space-y-2 text-sm">
                                                <div>原句结构：[主语] [动词] [介词短语]</div>
                                                <div>规则：保持SVO语序</div>
                                                <div>结果排列：这 猫 坐 在 这 垫子 上</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-red-100 p-4 rounded border border-red-300">
                                            <div class="font-bold text-red-700 mb-2">最终结果：</div>
                                            <div class="font-mono text-lg">"这 猫 坐 在 这 垫子 上"</div>
                                            <div class="text-xs text-red-600 mt-2">❌ 生硬，不自然，重复"这"</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-700 mb-4">📈 技术影响</h4>
                                    <div class="space-y-3 text-blue-600">
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>奠定了机器翻译的基础框架</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>建立了语言学与计算机的桥梁</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-red-500 font-bold">✗</span>
                                            <span>无法处理真实世界的语言复杂性</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-red-500 font-bold">✗</span>
                                            <span>开发成本高，维护困难</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第二阶段：统计革命 -->
                <div id="stage-statistical" class="evolution-stage hidden">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-4 sm:mb-6 text-orange-700">📊 第二阶段：统计革命 (1990s-2000s)</h3>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- 核心思想 -->
                            <div class="space-y-6">
                                <div class="bg-orange-50 p-6 rounded-lg border border-orange-200">
                                    <h4 class="text-xl font-bold text-orange-700 mb-4">💡 核心思想</h4>
                                    <p class="text-orange-600 mb-4">从大量平行语料中学习翻译概率，让数据说话而非规则</p>
                                    <div class="bg-white p-4 rounded border border-orange-100">
                                        <h5 class="font-bold text-orange-700 mb-2">统计模型示例：</h5>
                                        <ul class="text-sm text-orange-600 space-y-1">
                                            <li>• P("猫"|"cat") = 0.8</li>
                                            <li>• P("小猫"|"cat") = 0.15</li>
                                            <li>• P("feline"|"cat") = 0.05</li>
                                            <li>• N-gram：考虑词序概率</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                                    <h4 class="text-xl font-bold text-yellow-700 mb-4">⚠️ 主要局限</h4>
                                    <ul class="text-yellow-600 space-y-2">
                                        <li>• <strong>数据饥渴：</strong>需要海量平行语料</li>
                                        <li>• <strong>长距离依赖：</strong>难以处理长句中的语法关系</li>
                                        <li>• <strong>稀疏性问题：</strong>未见过的词组合概率为0</li>
                                        <li>• <strong>语言结构盲：</strong>缺乏深层语法理解</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 翻译演示 -->
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-orange-100 to-yellow-100 p-6 rounded-lg border border-orange-200">
                                    <h4 class="text-xl font-bold text-orange-700 mb-4">🔧 翻译过程演示</h4>
                                    <div class="space-y-4">
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 1: 词对齐概率</div>
                                            <div class="text-sm space-y-1">
                                                <div class="font-mono">"The" → "这"(0.6), ""(0.3), "那"(0.1)</div>
                                                <div class="font-mono">"cat" → "猫"(0.8), "小猫"(0.15), "猫咪"(0.05)</div>
                                                <div class="font-mono">"sat" → "坐"(0.7), "坐着"(0.2), "坐下"(0.1)</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 2: 语言模型评分</div>
                                            <div class="space-y-2 text-sm">
                                                <div>候选1：P("猫 坐 在 垫子 上") = 0.002</div>
                                                <div>候选2：P("这只 猫 坐在 垫子 上") = 0.008</div>
                                                <div>候选3：P("猫咪 坐 垫子 上面") = 0.001</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-orange-100 p-4 rounded border border-orange-300">
                                            <div class="font-bold text-orange-700 mb-2">最终结果：</div>
                                            <div class="font-mono text-lg">"这只猫坐在垫子上"</div>
                                            <div class="text-xs text-orange-600 mt-2">✓ 相比规则更自然，但仍有改进空间</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-700 mb-4">📈 技术影响</h4>
                                    <div class="space-y-3 text-blue-600">
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>首次实现数据驱动的翻译</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>建立了现代机器翻译的统计基础</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>显著提高了翻译流畅度</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-red-500 font-bold">✗</span>
                                            <span>对语言结构理解仍然有限</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第三阶段：神经网络 -->
                <div id="stage-neural" class="evolution-stage hidden">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-4 sm:mb-6 text-green-700">🧠 第三阶段：神经网络 (2010s)</h3>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- 核心思想 -->
                            <div class="space-y-6">
                                <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                                    <h4 class="text-xl font-bold text-green-700 mb-4">💡 核心思想</h4>
                                    <p class="text-green-600 mb-4">使用深度神经网络端到端学习翻译，自动学习语言表示</p>
                                    <div class="bg-white p-4 rounded border border-green-100">
                                        <h5 class="font-bold text-green-700 mb-2">关键技术：</h5>
                                        <ul class="text-sm text-green-600 space-y-1">
                                            <li>• Seq2Seq架构（编码器-解码器）</li>
                                            <li>• 循环神经网络（RNN/LSTM）</li>
                                            <li>• 词嵌入向量（Word Embeddings）</li>
                                            <li>• 端到端训练</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                                    <h4 class="text-xl font-bold text-yellow-700 mb-4">⚠️ 主要局限</h4>
                                    <ul class="text-yellow-600 space-y-2">
                                        <li>• <strong>静态词嵌入：</strong>"apple"在所有上下文中向量相同，无法区分"吃苹果"和"苹果公司"</li>
                                        <li>• <strong>信息瓶颈：</strong>编码器需要将整个句子压缩到固定向量</li>
                                        <li>• <strong>长序列问题：</strong>长句子容易遗忘前面信息</li>
                                        <li>• <strong>上下文盲：</strong>无法根据语境动态调整词义表示</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 翻译演示 -->
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-green-100 to-teal-100 p-6 rounded-lg border border-green-200">
                                    <h4 class="text-xl font-bold text-green-700 mb-4">🔧 翻译过程演示</h4>
                                    <div class="space-y-4">
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 1: 静态词嵌入编码</div>
                                            <div class="text-sm space-y-1">
                                                <div>The → [0.2, 0.8, -0.1, ...] (固定向量)</div>
                                                <div>cat → [0.1, -0.3, 0.9, ...] (固定向量)</div>
                                                <div class="text-red-600 text-xs mt-2">❌ 问题："cat"在"The cat sat"和"My cat loves fish"中向量完全相同</div>
                                                <div>句子编码：[0.3, 0.1, 0.5, ...] (通过RNN聚合)</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 2: 解码生成</div>
                                            <div class="space-y-2 text-sm">
                                                <div>输入句子向量 → 输出"这" (概率0.7)</div>
                                                <div>状态更新 → 输出"只" (概率0.6)</div>
                                                <div>状态更新 → 输出"猫" (概率0.9)</div>
                                                <div>逐词生成直到&lt;EOS&gt;</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-green-100 p-4 rounded border border-green-300">
                                            <div class="font-bold text-green-700 mb-2">最终结果：</div>
                                            <div class="font-mono text-lg">"这只猫坐在垫子上"</div>
                                            <div class="text-xs text-green-600 mt-2">✓ 更好的语法结构，更自然的表达</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-700 mb-4">📈 技术影响</h4>
                                    <div class="space-y-3 text-blue-600">
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>实现端到端可微分训练</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>自动学习语言表示，无需人工特征</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>大幅提升翻译质量</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-red-500 font-bold">✗</span>
                                            <span>静态词嵌入无法处理一词多义</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-blue-500 font-bold">→</span>
                                            <span>推动了动态上下文表示的发展</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第四阶段：注意力机制 -->
                <div id="stage-attention" class="evolution-stage hidden">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-4 sm:mb-6 text-blue-700">👁️ 第四阶段：注意力机制 (2014-2016)</h3>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- 核心思想 -->
                            <div class="space-y-6">
                                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-700 mb-4">💡 核心思想</h4>
                                    <p class="text-blue-600 mb-4">在RNN/LSTM基础上引入注意力机制，开始解决静态嵌入问题，让模型在生成每个词时，动态关注源句子的不同部分</p>
                                    <div class="bg-white p-4 rounded border border-blue-100">
                                        <h5 class="font-bold text-blue-700 mb-2">关键技术：</h5>
                                        <ul class="text-sm text-blue-600 space-y-1">
                                            <li>• Bahdanau Attention (2014)</li>
                                            <li>• Luong Attention (2015)</li>
                                            <li>• 基于RNN/LSTM的编码器-解码器</li>
                                            <li>• 动态上下文向量生成</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                                    <h4 class="text-xl font-bold text-yellow-700 mb-4">⚠️ 主要局限</h4>
                                    <ul class="text-yellow-600 space-y-2">
                                        <li>• <strong>仍依赖RNN：</strong>编码器-解码器仍基于RNN/LSTM架构</li>
                                        <li>• <strong>串行处理：</strong>无法并行计算，训练速度受限</li>
                                        <li>• <strong>梯度问题：</strong>长序列仍存在梯度消失问题</li>
                                        <li>• <strong>计算效率：</strong>RNN串行特性限制了计算效率</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 翻译演示 -->
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-blue-100 to-indigo-100 p-6 rounded-lg border border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-700 mb-4">🔧 翻译过程演示</h4>
                                    <div class="space-y-4">
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 1: RNN编码所有位置</div>
                                            <div class="text-sm space-y-1">
                                                <div>h₁ = LSTM("The") = [0.2, 0.1, 0.8]</div>
                                                <div>h₂ = LSTM("cat") = [0.5, -0.2, 0.3]</div>
                                                <div>h₃ = LSTM("sat") = [-0.1, 0.7, 0.4]</div>
                                                <div>h₄ = LSTM("on") = [0.3, 0.2, -0.5]</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 2: 注意力权重计算</div>
                                            <div class="space-y-2 text-sm">
                                                <div>解码器状态s₁与编码器对齐：</div>
                                                <div>e₁ = score(s₁, h₁) = 0.1</div>
                                                <div>e₂ = score(s₁, h₂) = 0.8 ⭐</div>
                                                <div>e₃ = score(s₁, h₃) = 0.05</div>
                                                <div>α = softmax([0.1, 0.8, 0.05, ...])</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-blue-100 p-4 rounded border border-blue-300">
                                            <div class="font-bold text-blue-700 mb-2">最终结果：</div>
                                            <div class="font-mono text-lg">"这只猫坐在垫子上"</div>
                                            <div class="text-xs text-blue-600 mt-2">✓ 精确对齐，语义保真度更高</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-700 mb-4">📈 技术影响</h4>
                                    <div class="space-y-3 text-blue-600">
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>首次解决了编码器信息瓶颈问题</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>显著提高长句翻译质量</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>证明了注意力机制的有效性</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-blue-500 font-bold">→</span>
                                            <span>为2017年Transformer"纯注意力"架构铺路</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第五阶段：Transformer -->
                <div id="stage-transformer" class="evolution-stage hidden">
                    <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-4 sm:mb-6 text-purple-700">🚀 第五阶段：Transformer (2017至今)</h3>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- 核心思想 -->
                            <div class="space-y-6">
                                <div class="bg-purple-50 p-6 rounded-lg border border-purple-200">
                                    <h4 class="text-xl font-bold text-purple-700 mb-4">💡 核心思想</h4>
                                    <p class="text-purple-600 mb-4">完全基于注意力机制，抛弃循环结构，彻底解决静态嵌入问题，实现动态上下文表示</p>
                                    <div class="bg-white p-4 rounded border border-purple-100">
                                        <h5 class="font-bold text-purple-700 mb-2">关键创新：</h5>
                                        <ul class="text-sm text-purple-600 space-y-1">
                                            <li>• Multi-Head Self-Attention</li>
                                            <li>• 位置编码（Positional Encoding）</li>
                                            <li>• 完全并行训练</li>
                                            <li>• 残差连接与层归一化</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                                    <h4 class="text-xl font-bold text-yellow-700 mb-4">⚠️ 当前挑战</h4>
                                    <ul class="text-yellow-600 space-y-2">
                                        <li>• <strong>计算资源：</strong>训练大模型需要海量计算</li>
                                        <li>• <strong>数据需求：</strong>需要TB级别的训练数据</li>
                                        <li>• <strong>可解释性：</strong>模型决策过程难以理解</li>
                                        <li>• <strong>幻觉问题：</strong>可能生成不准确信息</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 翻译演示 -->
                            <div class="space-y-6">
                                <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-lg border border-purple-200">
                                    <h4 class="text-xl font-bold text-purple-700 mb-4">🔧 翻译过程演示</h4>
                                    <div class="space-y-4">
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 1: 并行Self-Attention</div>
                                            <div class="text-sm space-y-1">
                                                <div>每个词同时关注所有其他词：</div>
                                                <div>"cat" 根据上下文动态调整表示</div>
                                                <div>"The" ↔ ["cat", "sat", "on", "mat"]</div>
                                                <div class="text-green-600 text-xs mt-2">✓ 解决："cat"在不同句子中产生不同的上下文向量</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-4 rounded border">
                                            <div class="font-bold text-gray-700 mb-2">Step 2: 多头注意力融合</div>
                                            <div class="space-y-2 text-sm">
                                                <div>Head 1: 关注语法关系</div>
                                                <div>Head 2: 关注语义相似性</div>
                                                <div>Head 3: 关注位置信息</div>
                                                <div>融合：更丰富的表示</div>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-purple-100 p-4 rounded border border-purple-300">
                                            <div class="font-bold text-purple-700 mb-2">最终结果：</div>
                                            <div class="font-mono text-lg">"这只猫坐在垫子上"</div>
                                            <div class="text-xs text-purple-600 mt-2">✓ 接近人类水平，流畅自然</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                    <h4 class="text-xl font-bold text-blue-700 mb-4">📈 技术影响</h4>
                                    <div class="space-y-3 text-blue-600">
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>实现完全并行训练，大幅提升效率</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>可扩展到数千亿参数</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>统一NLP架构，推动AGI发展</span>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="text-green-500 font-bold">✓</span>
                                            <span>孕育出GPT、BERT等里程碑模型</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 其他阶段将通过JavaScript动态显示 -->
                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-8 rounded-xl shadow-sm border border-indigo-200">
                    <h3 class="text-2xl font-bold mb-6 text-center text-indigo-800">🎯 技术演进总结</h3>
                    <div class="grid md:grid-cols-5 gap-4 text-center">
                        <div class="bg-white p-4 rounded-lg border border-red-200">
                            <div class="text-2xl mb-2">📋</div>
                            <div class="font-bold text-red-700">规则驱动</div>
                            <div class="text-xs text-red-600 mt-2">人工规则<br>生硬死板</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-orange-200">
                            <div class="text-2xl mb-2">📊</div>
                            <div class="font-bold text-orange-700">统计方法</div>
                            <div class="text-xs text-orange-600 mt-2">概率学习<br>有限上下文</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-green-200">
                            <div class="text-2xl mb-2">🧠</div>
                            <div class="font-bold text-green-700">神经网络</div>
                            <div class="text-xs text-green-600 mt-2">端到端学习<br>语义理解</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-blue-200">
                            <div class="text-2xl mb-2">👁️</div>
                            <div class="font-bold text-blue-700">注意力机制</div>
                            <div class="text-xs text-blue-600 mt-2">动态对齐<br>长距离依赖</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border border-purple-200">
                            <div class="text-2xl mb-2">🚀</div>
                            <div class="font-bold text-purple-700">Transformer</div>
                            <div class="text-xs text-purple-600 mt-2">并行计算<br>大模型时代</div>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <p class="text-lg text-indigo-700 font-semibold">从"这 猫 坐 在 这 垫子 上" → "猫坐在垫子上。"</p>
                        <p class="text-sm text-indigo-600 mt-2">见证了从规则到智能的伟大跨越</p>
                    </div>
                </div>
            </section>

            <section id="vectors" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-6 sm:mb-8 text-[#4338CA]">核心基石：向量的演进之路</h2>
                <p class="text-lg sm:text-xl leading-relaxed mb-6 sm:mb-8 text-gray-700">向量技术的发展历程，是一个从"数字标记"到"语义理解"的精彩演进故事。让我们追溯这段历史，理解为什么向量成为了大模型的核心基石。</p>
                
                <!-- 历史演进时间线 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <h3 class="text-2xl font-semibold mb-6 text-center">🕰️ 向量技术发展历程</h3>
                    <div class="relative">
                        <!-- 时间线主轴 -->
                        <div class="absolute left-1/2 transform -translate-x-0.5 h-full w-1 bg-gradient-to-b from-red-400 via-orange-400 via-green-400 to-blue-400"></div>
                        
                        <!-- 第一阶段：数字标记问题 -->
                        <div class="mb-8 flex items-center">
                            <div class="w-1/2 pr-8 text-right">
                                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                    <h4 class="font-bold text-red-700 mb-2">❌ 早期：简单数字标记</h4>
                                    <p class="text-sm text-red-600 mb-2">北京=1, 上海=2, 东京=3</p>
                                    <p class="text-xs text-red-500">问题：神经网络误学习到 北京 < 上海 < 东京</p>
                                </div>
                            </div>
                            <div class="w-8 h-8 bg-red-400 rounded-full border-4 border-white shadow-lg flex items-center justify-center relative z-10">
                                <span class="text-white font-bold text-sm">1</span>
                            </div>
                            <div class="w-1/2 pl-8"></div>
                        </div>
                        
                        <!-- 第二阶段：稀疏正交向量 -->
                        <div class="mb-8 flex items-center">
                            <div class="w-1/2 pr-8"></div>
                            <div class="w-8 h-8 bg-orange-400 rounded-full border-4 border-white shadow-lg flex items-center justify-center relative z-10">
                                <span class="text-white font-bold text-sm">2</span>
                            </div>
                            <div class="w-1/2 pl-8">
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                    <h4 class="font-bold text-orange-700 mb-2">🎯 突破：稀疏正交向量</h4>
                                    <p class="text-sm text-orange-600 mb-2">北京=[1,0,0], 上海=[0,1,0], 东京=[0,0,1]</p>
                                    <p class="text-xs text-orange-500">优势：避免大小关系，但维度爆炸</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 第三阶段：Word2Vec革命 -->
                        <div class="mb-8 flex items-center">
                            <div class="w-1/2 pr-8 text-right">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                    <h4 class="font-bold text-green-700 mb-2">🚀 革命：Word2Vec (2013)</h4>
                                    <p class="text-sm text-green-600 mb-2">稠密向量捕捉语义关系</p>
                                    <p class="text-xs text-green-500">国王 - 男人 + 女人 = 女王</p>
                                </div>
                            </div>
                            <div class="w-8 h-8 bg-green-400 rounded-full border-4 border-white shadow-lg flex items-center justify-center relative z-10">
                                <span class="text-white font-bold text-sm">3</span>
                            </div>
                            <div class="w-1/2 pl-8"></div>
                        </div>
                        
                        <!-- 第四阶段：现代大模型 -->
                        <div class="flex items-center">
                            <div class="w-1/2 pr-8"></div>
                            <div class="w-8 h-8 bg-blue-400 rounded-full border-4 border-white shadow-lg flex items-center justify-center relative z-10">
                                <span class="text-white font-bold text-sm">4</span>
                            </div>
                            <div class="w-1/2 pl-8">
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                    <h4 class="font-bold text-blue-700 mb-2">🎊 现代：动态上下文向量</h4>
                                    <p class="text-sm text-blue-600 mb-2">Transformer时代的上下文感知</p>
                                    <p class="text-xs text-blue-500">同一个词在不同语境下有不同向量</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 详细问题分析 -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <!-- 数字标记的问题 -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-xl font-semibold mb-4 text-red-700">🚨 数字标记的致命缺陷</h3>
                        <div class="space-y-4">
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <h4 class="font-bold text-red-700 mb-2">原始方案</h4>
                                <div class="font-mono text-sm space-y-1">
                                    <div>北京 → 1</div>
                                    <div>上海 → 2</div>
                                    <div>东京 → 3</div>
                                    <div>巴黎 → 4</div>
                                </div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <h4 class="font-bold text-yellow-700 mb-2">⚠️ 意外的数学关系</h4>
                                <ul class="text-sm text-yellow-600 space-y-1">
                                    <li>• 神经网络学到：上海 = 北京 + 1</li>
                                    <li>• 错误推断：东京 > 上海 > 北京</li>
                                    <li>• 地理距离被误解为数值大小</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 稀疏正交向量的解决方案 -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <h3 class="text-xl font-semibold mb-4 text-orange-700">🎯 稀疏正交向量的智慧</h3>
                        <div class="space-y-4">
                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                <h4 class="font-bold text-orange-700 mb-2">One-Hot编码</h4>
                                <div class="font-mono text-sm space-y-1">
                                    <div>北京 → [1, 0, 0, 0]</div>
                                    <div>上海 → [0, 1, 0, 0]</div>
                                    <div>东京 → [0, 0, 1, 0]</div>
                                    <div>巴黎 → [0, 0, 0, 1]</div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-700 mb-2">✅ 解决的问题</h4>
                                <ul class="text-sm text-green-600 space-y-1">
                                    <li>• 消除了数值大小关系</li>
                                    <li>• 每个城市都"正交"独立</li>
                                    <li>• 点积为0，无数学偏见</li>
                                </ul>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <h4 class="font-bold text-red-700 mb-2">❌ 新的问题</h4>
                                <ul class="text-sm text-red-600 space-y-1">
                                    <li>• 维度爆炸：10万词汇 = 10万维</li>
                                    <li>• 无法表达语义相似性</li>
                                    <li>• 存储和计算开销巨大</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Word2Vec的突破 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <h3 class="text-2xl font-semibold mb-6 text-center text-green-700">🚀 Word2Vec：稠密向量的革命</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="space-y-4">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-700 mb-2">核心思想</h4>
                                <p class="text-sm text-green-600">"一个词的含义由它的邻居决定"</p>
                                <p class="text-xs text-green-500 mt-2">通过大量文本学习词汇的上下文分布</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-bold text-blue-700 mb-2">技术突破</h4>
                                <ul class="text-sm text-blue-600 space-y-1">
                                    <li>• 降维：10万词 → 300维</li>
                                    <li>• 稠密：每维都有意义</li>
                                    <li>• 连续：相似词距离近</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-b from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="font-bold text-purple-700 mb-3 text-center">🎯 经典例子</h4>
                            <div class="space-y-3 text-sm">
                                <div class="bg-white p-2 rounded border">
                                    <span class="font-mono">国王 - 男人 + 女人</span>
                                </div>
                                <div class="text-center text-xl">↓</div>
                                <div class="bg-yellow-100 p-2 rounded border border-yellow-300">
                                    <span class="font-mono font-bold">= 女王</span>
                                </div>
                            </div>
                            <p class="text-xs text-purple-600 mt-3 text-center">
                                向量运算捕捉到了"性别"这一语义维度
                            </p>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <h4 class="font-bold text-yellow-700 mb-2">语义聚类</h4>
                                <div class="text-xs space-y-1">
                                    <div><strong>动物：</strong>猫、狗、马...</div>
                                    <div><strong>城市：</strong>北京、上海、东京...</div>
                                    <div><strong>颜色：</strong>红、蓝、绿...</div>
                                </div>
                                <p class="text-xs text-yellow-600 mt-2">
                                    相似概念在向量空间中自然聚集
                                </p>
                            </div>
                            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                                <h4 class="font-bold text-indigo-700 mb-2">方向的意义</h4>
                                <ul class="text-xs text-indigo-600 space-y-1">
                                    <li>• 性别方向：男性 ↔ 女性</li>
                                    <li>• 时态方向：现在 ↔ 过去</li>
                                    <li>• 程度方向：好 ↔ 极好</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 现代演进：上下文感知 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <h3 class="text-2xl font-semibold mb-6 text-center text-blue-700">🌟 现代进化：动态上下文向量</h3>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-bold text-blue-700 mb-2">Word2Vec的局限</h4>
                                <div class="text-sm text-blue-600 space-y-2">
                                    <p><strong>静态表示：</strong>每个词只有一个固定向量</p>
                                    <p><strong>例子问题：</strong></p>
                                    <div class="ml-4 space-y-1 text-xs">
                                        <div>"银行的利率很高" 🏦</div>
                                        <div>"河岸的风景很美" 🌊</div>
                                    </div>
                                    <p class="text-xs text-blue-500">同一个"银行"词，语义完全不同</p>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-700 mb-2">Transformer的突破</h4>
                                <ul class="text-sm text-green-600 space-y-1">
                                    <li>• <strong>动态生成：</strong>根据上下文实时计算</li>
                                    <li>• <strong>语境感知：</strong>同词不同语境不同向量</li>
                                    <li>• <strong>注意力机制：</strong>动态关注相关信息</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-100 to-purple-100 p-6 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-center mb-4">🔄 动态向量生成过程</h4>
                            <div class="space-y-3 text-sm">
                                <div class="bg-white p-3 rounded border">
                                    <div class="font-bold">输入文本：</div>
                                    <div class="font-mono">"银行的利率很高"</div>
                                </div>
                                <div class="text-center text-lg">↓</div>
                                <div class="bg-yellow-100 p-3 rounded border border-yellow-300">
                                    <div class="font-bold">上下文分析：</div>
                                    <div class="text-xs">利率 → 金融语境</div>
                                </div>
                                <div class="text-center text-lg">↓</div>
                                <div class="bg-green-100 p-3 rounded border border-green-300">
                                    <div class="font-bold">动态向量：</div>
                                    <div class="font-mono text-xs">[0.2, 0.8, 0.1, ...] (金融含义)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 交互式可视化：保留原有的二维投影 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-2xl font-semibold mb-6 text-center">📊 向量空间可视化</h3>
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                            <div class="space-y-4">
                                <h4 class="text-xl font-semibold">向量的语义关系</h4>
                                <p class="text-gray-700">虽然实际向量通常有几百到几千维，但我们可以将其投影到二维平面来观察语义关系。相似的词汇在空间中会聚集在一起。</p>
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                    <p class="text-sm text-blue-700 mb-2"><strong>观察要点：</strong></p>
                                    <ul class="text-sm text-blue-600 space-y-1">
                                        <li>• <strong>距离：</strong>语义相似度</li>
                                        <li>• <strong>方向：</strong>语义关系类型</li>
                                        <li>• <strong>聚类：</strong>概念分类</li>
                                    </ul>
                                </div>
                            <div>
                               <button id="plot-related" class="bg-[#4338CA] text-white px-4 sm:px-6 py-3 rounded-lg hover:bg-[#3730A3] transition min-h-[44px] text-sm sm:text-base">绘制相关词</button>
                               <button id="plot-unrelated" class="bg-gray-200 text-gray-800 px-4 sm:px-6 py-3 rounded-lg hover:bg-gray-300 transition ml-2 min-h-[44px] text-sm sm:text-base">绘制无关词</button>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                        <div class="chart-container">
                            <canvas id="vectorChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="transformer" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-4 text-[#4338CA]">核心引擎：Transformer</h2>
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8 relative">
                    <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-2 text-center">革命性创新：自注意力机制</h3>
                    <p class="text-center mb-6 text-gray-600">将鼠标悬停在下方句子的单词上，观察它如何动态地“关注”其他单词，从而理解上下文。</p>
                    <div id="attention-sentence" class="text-3xl font-medium text-center space-x-4 p-4 relative z-10">
                        <span class="attention-word p-2" data-id="0">The</span>
                        <span class="attention-word p-2" data-id="1">cat</span>
                        <span class="attention-word p-2" data-id="2">sat</span>
                        <span class="attention-word p-2" data-id="3">on</span>
                        <span class="attention-word p-2" data-id="4">the</span>
                        <span class="attention-word p-2" data-id="5">mat</span>
                    </div>
                    <div id="attention-lines-container" class="absolute top-0 left-0 w-full h-full pointer-events-none"></div>
                    <div id="attention-tooltip" class="mt-6 text-center text-lg h-12 text-gray-600">
                        <p>请悬停体验</p>
                    </div>
                </div>
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4 sm:mb-6 text-center">三大主流架构</h3>
                    <div class="flex justify-center space-x-4 mb-6">
                        <button class="arch-button bg-[#4338CA] text-white px-4 sm:px-6 py-3 rounded-lg min-h-[44px] text-sm sm:text-base" data-arch="enc-dec">Encoder-Decoder</button>
                        <button class="arch-button bg-gray-200 text-gray-800 px-4 sm:px-6 py-3 rounded-lg min-h-[44px] text-sm sm:text-base" data-arch="enc-only">Encoder-Only</button>
                        <button class="arch-button bg-gray-200 text-gray-800 px-4 sm:px-6 py-3 rounded-lg min-h-[44px] text-sm sm:text-base" data-arch="dec-only">Decoder-Only</button>
                    </div>
                    <div id="arch-display"></div>
                </div>
            </section>

            <section id="training" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-6 sm:mb-8 text-[#4338CA]">训练概述：学习预测的艺术</h2>
                <p class="text-xl leading-relaxed mb-8 text-gray-700">以GPT这类Decoder-Only模型为例，其训练过程极其“单纯”而暴力：在海量文本上，永无止境地进行“预测下一个词”的任务。这个过程被称为“教师强制（Teacher Forcing）”。</p>
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-2xl font-semibold mb-4">训练流程：一次精准的“批改作业”</h3>
                    <div class="flex flex-col md:flex-row items-center gap-6 font-mono text-center">
                        <div class="arch-box">Input: "an"</div>
                        <div class="arch-arrow">→</div>
                        <div class="arch-box">模型预测<br>(输出10000维Logits)</div>
                        <div class="arch-arrow">→</div>
                        <div class="arch-box">对比答案: "apple"</div>
                        <div class="arch-arrow">→</div>
                        <div class="arch-box">计算损失 (Loss)</div>
                    </div>
                    <div class="mt-6">
                        <h4 class="text-xl font-semibold">损失函数 (Cross-Entropy Loss)</h4>
                        <p class="mt-2 text-gray-700">损失函数就像一位严格的老师。模型会对词汇表中所有词给出一个概率，比如预测"apple"的概率是8%。损失函数会衡量这个预测概率（8%）与标准答案（100%）之间的差距。差距越大，损失值就越高，模型参数需要调整的幅度就越大。训练的目标，就是通过不断调整参数，让这个损失值变得尽可能小。</p>
                    </div>
                </div>
                
                <!-- 掩码机制详细说明 -->
                <div class="mt-8 bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-2xl font-semibold mb-6 text-center">🎭 掩码机制：控制"未来"信息的关键</h3>
                    <p class="text-lg text-gray-700 mb-6">在训练过程中，模型使用"掩码多头自注意力"确保在预测某个位置的词时，只能看到它前面的词，而不能"偷看"后面的答案。这通过上三角掩码矩阵来实现。</p>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- 训练序列展示 -->
                        <div class="space-y-4">
                            <h4 class="text-xl font-semibold text-indigo-700">训练序列：an apple a day</h4>
                            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                                <p class="text-sm text-indigo-600 mb-3 font-semibold">原始序列（无特殊token）：</p>
                                <div class="flex flex-wrap gap-2 justify-center">
                                    <div class="bg-white border-2 border-indigo-300 px-3 py-2 rounded font-mono text-sm">an</div>
                                    <div class="bg-white border-2 border-indigo-300 px-3 py-2 rounded font-mono text-sm">apple</div>
                                    <div class="bg-white border-2 border-indigo-300 px-3 py-2 rounded font-mono text-sm">a</div>
                                    <div class="bg-white border-2 border-indigo-300 px-3 py-2 rounded font-mono text-sm">day</div>
                                </div>
                                <p class="text-xs text-indigo-500 mt-2 text-center">位置：0, 1, 2, 3</p>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <p class="text-sm text-green-600 mb-3 font-semibold">训练任务（同时进行的预测）：</p>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-center gap-2">
                                        <span class="bg-blue-100 px-2 py-1 rounded border font-mono text-xs">位置0</span>
                                        <span class="bg-white px-2 py-1 rounded border font-mono">""</span>
                                        <span class="text-gray-500">→ 预测</span>
                                        <span class="bg-green-200 px-2 py-1 rounded border font-mono font-bold">an</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="bg-blue-100 px-2 py-1 rounded border font-mono text-xs">位置1</span>
                                        <span class="bg-white px-2 py-1 rounded border font-mono">an</span>
                                        <span class="text-gray-500">→ 预测</span>
                                        <span class="bg-green-200 px-2 py-1 rounded border font-mono font-bold">apple</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="bg-blue-100 px-2 py-1 rounded border font-mono text-xs">位置2</span>
                                        <span class="bg-white px-2 py-1 rounded border font-mono">an apple</span>
                                        <span class="text-gray-500">→ 预测</span>
                                        <span class="bg-green-200 px-2 py-1 rounded border font-mono font-bold">a</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="bg-blue-100 px-2 py-1 rounded border font-mono text-xs">位置3</span>
                                        <span class="bg-white px-2 py-1 rounded border font-mono">an apple a</span>
                                        <span class="text-gray-500">→ 预测</span>
                                        <span class="bg-green-200 px-2 py-1 rounded border font-mono font-bold">day</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 掩码矩阵展示 -->
                        <div class="space-y-4">
                            <h4 class="text-xl font-semibold text-red-700">掩码可见性矩阵</h4>
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <p class="text-sm text-red-600 mb-3 font-semibold">每个预测任务的可见范围：</p>
                                
                                <!-- 掩码展示 -->
                                <div class="space-y-3">
                                    <!-- 预测位置0 -->
                                    <div class="bg-white p-3 rounded border">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="bg-blue-100 px-2 py-1 rounded text-xs font-bold">预测位置0</span>
                                            <span class="text-gray-600 text-sm">→ 预测"an"</span>
                                        </div>
                                        <div class="flex gap-1 text-xs">
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">无前文，从空开始预测</p>
                                    </div>
                                    
                                    <!-- 预测位置1 -->
                                    <div class="bg-white p-3 rounded border">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="bg-blue-100 px-2 py-1 rounded text-xs font-bold">预测位置1</span>
                                            <span class="text-gray-600 text-sm">→ 预测"apple"</span>
                                        </div>
                                        <div class="flex gap-1 text-xs">
                                            <div class="bg-green-200 px-2 py-1 rounded border font-mono">an</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">可以看到: an</p>
                                    </div>
                                    
                                    <!-- 预测位置2 -->
                                    <div class="bg-white p-3 rounded border">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="bg-blue-100 px-2 py-1 rounded text-xs font-bold">预测位置2</span>
                                            <span class="text-gray-600 text-sm">→ 预测"a"</span>
                                        </div>
                                        <div class="flex gap-1 text-xs">
                                            <div class="bg-green-200 px-2 py-1 rounded border font-mono">an</div>
                                            <div class="bg-green-200 px-2 py-1 rounded border font-mono">apple</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">可以看到: an apple</p>
                                    </div>
                                    
                                    <!-- 预测位置3 -->
                                    <div class="bg-white p-3 rounded border">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="bg-blue-100 px-2 py-1 rounded text-xs font-bold">预测位置3</span>
                                            <span class="text-gray-600 text-sm">→ 预测"day"</span>
                                        </div>
                                        <div class="flex gap-1 text-xs">
                                            <div class="bg-green-200 px-2 py-1 rounded border font-mono">an</div>
                                            <div class="bg-green-200 px-2 py-1 rounded border font-mono">apple</div>
                                            <div class="bg-green-200 px-2 py-1 rounded border font-mono">a</div>
                                            <div class="bg-red-200 px-2 py-1 rounded border font-mono">MASK</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">可以看到: an apple a</p>
                                    </div>
                                </div>
                                
                                <div class="mt-4 flex items-center gap-4 text-xs">
                                    <div class="flex items-center gap-1">
                                        <div class="w-4 h-4 bg-green-200 border"></div>
                                        <span>可见词汇</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <div class="w-4 h-4 bg-red-200 border"></div>
                                        <span>被掩码隐藏</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 核心概念说明 -->
                    <div class="mt-6 grid md:grid-cols-2 gap-6">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h5 class="font-bold text-blue-700 mb-3">💡 为什么需要掩码？</h5>
                            <div class="space-y-2 text-sm text-blue-700">
                                <p>• <strong>防止作弊</strong>：训练时不能看到"未来"的答案</p>
                                <p>• <strong>模拟推理</strong>：推理时也只能逐步生成，无法预知后续</p>
                                <p>• <strong>保证因果性</strong>：确保语言模型的自回归特性</p>
                                <p>• <strong>并行训练</strong>：虽然推理是顺序的，但训练可以并行</p>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h5 class="font-bold text-purple-700 mb-3">🔧 掩码的实际作用</h5>
                            <div class="space-y-2 text-sm text-purple-700">
                                <p>• <strong>注意力控制</strong>：只计算允许位置的注意力权重</p>
                                <p>• <strong>信息隔离</strong>：彻底阻断"未来"信息的流入</p>
                                <p>• <strong>上三角形式</strong>：矩阵上三角部分全部为0（-∞）</p>
                                <p>• <strong>训练一致性</strong>：训练和推理使用相同的约束</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 技术实现说明 -->
                    <div class="mt-6 p-4 bg-gradient-to-r from-gray-100 to-gray-200 rounded-lg border border-gray-300">
                        <h5 class="font-bold text-gray-700 mb-3 text-center">⚙️ 技术实现：注意力掩码的应用</h5>
                        <div class="grid md:grid-cols-2 gap-4 text-sm">
                            <div class="bg-white p-3 rounded border">
                                <p class="font-semibold text-gray-700 mb-2">1. 计算原始注意力分数</p>
                                <div class="font-mono text-xs bg-gray-100 p-2 rounded">
                                    attention_scores = Q @ K.T / √d_k
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <p class="font-semibold text-gray-700 mb-2">2. 应用掩码</p>
                                <div class="font-mono text-xs bg-gray-100 p-2 rounded">
                                    masked_scores = attention_scores + mask<br>
                                    # mask中0位置 = -∞ (实际是-1e9)
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <p class="font-semibold text-gray-700 mb-2">3. Softmax归一化</p>
                                <div class="font-mono text-xs bg-gray-100 p-2 rounded">
                                    attention_weights = softmax(masked_scores)<br>
                                    # -∞位置的权重变为0
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <p class="font-semibold text-gray-700 mb-2">4. 加权求和</p>
                                <div class="font-mono text-xs bg-gray-100 p-2 rounded">
                                    output = attention_weights @ V<br>
                                    # 未来信息被完全屏蔽
                                </div>
                            </div>
                        </div>
                        <p class="text-center text-xs text-gray-600 mt-3">
                            <strong>核心目的：</strong>确保模型在训练时无法"作弊"，必须基于当前及之前的信息来预测下一个词
                        </p>
                    </div>
                </div>
            </section>
            
            <section id="decoder-arch" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-6 sm:mb-8 text-[#4338CA]">解码器架构：深入核心</h2>
                <p class="text-xl leading-relaxed mb-8 text-gray-700">GPT这类Decoder-Only模型的核心是<strong>重复堆叠的解码器模块</strong>。让我们逐步拆解每个组件，了解现代大模型（包括MoE架构）的精巧设计。</p>
                
                <!-- 架构概览 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <h3 class="text-2xl font-semibold mb-6 text-center">🏗️ 整体架构概览</h3>
                    <div class="flex flex-col items-center space-y-4">
                        <div class="arch-box bg-blue-50 border-blue-300">输入文本</div>
                        <div class="arch-arrow">↓</div>
                        <div class="arch-box bg-green-50 border-green-300">词嵌入 + 位置编码</div>
                        <div class="arch-arrow">↓</div>
                        
                        <!-- 重复的解码器层 -->
                        <div class="border-2 border-dashed border-indigo-300 p-6 rounded-lg bg-indigo-50 w-full max-w-md">
                            <div class="text-center font-bold text-indigo-700 mb-4">🔄 解码器层 × N (如96层)</div>
                            <div class="space-y-3">
                                <div class="arch-component bg-purple-100 border-purple-300">多头自注意力 (MHA)</div>
                                <div class="arch-component bg-orange-100 border-orange-300">前馈网络 (FFN/MoE)</div>
                                <div class="text-xs text-gray-600 text-center">+ 残差连接 & 层归一化</div>
                            </div>
                        </div>
                        
                        <div class="arch-arrow">↓</div>
                        <div class="arch-box bg-yellow-50 border-yellow-300">输出层 (词汇表预测)</div>
                        <div class="arch-arrow">↓</div>
                        <div class="arch-box bg-red-50 border-red-300">生成下一个词</div>
                    </div>
                    
                    <div class="mt-6 grid md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-blue-700">📊 规模示例</h4>
                            <ul class="text-blue-600 mt-2 space-y-1">
                                <li>• GPT-3: 96层解码器</li>
                                <li>• GPT-4: ~120层+</li>
                                <li>• Llama 2-70B: 80层</li>
                            </ul>
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200">
                            <h4 class="font-bold text-green-700">🎯 核心特点</h4>
                            <ul class="text-green-600 mt-2 space-y-1">
                                <li>• 单向注意力（掩码）</li>
                                <li>• 自回归生成</li>
                                <li>• 层层抽象理解</li>
                            </ul>
                        </div>
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="font-bold text-purple-700">🚀 现代进化</h4>
                            <ul class="text-purple-600 mt-2 space-y-1">
                                <li>• MoE专家混合</li>
                                <li>• 注意力优化</li>
                                <li>• 激活函数创新</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- 交互式组件选择器 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <h3 class="text-2xl font-semibold mb-6 text-center">🔍 深入组件细节</h3>
                    <div class="flex flex-wrap justify-center gap-4 mb-6">
                        <button class="component-btn bg-purple-100 hover:bg-purple-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-purple-300 font-semibold text-purple-700 transition min-h-[44px] text-sm sm:text-base" data-component="attention" onclick="showComponent('attention')">
                            🧠 多头注意力 (MHA)
                        </button>
                        <button class="component-btn bg-orange-100 hover:bg-orange-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-orange-300 font-semibold text-orange-700 transition min-h-[44px] text-sm sm:text-base" data-component="ffn" onclick="showComponent('ffn')">
                            ⚡ 前馈网络 (FFN)
                        </button>
                        <button class="component-btn bg-green-100 hover:bg-green-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-green-300 font-semibold text-green-700 transition min-h-[44px] text-sm sm:text-base" data-component="moe" onclick="showComponent('moe')">
                            🎯 专家混合 (MoE)
                        </button>
                        <button class="component-btn bg-indigo-100 hover:bg-indigo-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-indigo-300 font-semibold text-indigo-700 transition min-h-[44px] text-sm sm:text-base" data-component="residual" onclick="showComponent('residual')">
                            🔗 残差连接
                        </button>
                    </div>

                    <!-- 注意力组件详解 -->
                    <div id="component-attention" class="component-detail">
                        <h4 class="text-xl font-bold mb-4 text-purple-700">🧠 多头自注意力 (Multi-Head Attention)</h4>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                    <h5 class="font-bold text-purple-700 mb-2">核心流程</h5>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex items-center gap-2">
                                            <span class="w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                                            <span>线性变换生成 Q, K, V</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-xs font-bold">2</span>
                                            <span>多头分割 (如8个头)</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                                            <span>并行计算注意力</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="w-6 h-6 bg-purple-200 rounded-full flex items-center justify-center text-xs font-bold">4</span>
                                            <span>多头结果拼接</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                    <h5 class="font-bold text-red-700 mb-2">🚫 掩码机制</h5>
                                    <p class="text-sm text-red-600">防止模型"偷看"未来信息，确保预测的公平性</p>
                                </div>
                            </div>
                            <div class="bg-gradient-to-b from-purple-100 to-indigo-100 p-4 rounded-lg">
                                <h5 class="font-bold text-center mb-3">多头并行处理</h5>
                                <div class="grid grid-cols-2 gap-2 text-xs">
                                    <div class="bg-white p-2 rounded border text-center">Head 1<br>语法关系</div>
                                    <div class="bg-white p-2 rounded border text-center">Head 2<br>语义关联</div>
                                    <div class="bg-white p-2 rounded border text-center">Head 3<br>位置关系</div>
                                    <div class="bg-white p-2 rounded border text-center">Head 4<br>上下文</div>
                                </div>
                                <div class="text-center mt-2 text-xs text-gray-600">每个头关注不同的语言特征</div>
                            </div>
                        </div>
                    </div>

                    <!-- FFN组件详解 -->
                    <div id="component-ffn" class="component-detail hidden">
                        <h4 class="text-xl font-bold mb-4 text-orange-700">⚡ 前馈神经网络 (Feed-Forward Network)</h4>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                    <h5 class="font-bold text-orange-700 mb-2">经典FFN结构</h5>
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center bg-white p-2 rounded border">
                                            <span class="text-sm font-semibold">输入</span>
                                            <span class="text-xs text-gray-600">d_model维</span>
                                        </div>
                                        <div class="text-center text-gray-400">↓</div>
                                        <div class="flex justify-between items-center bg-white p-2 rounded border">
                                            <span class="text-sm font-semibold">W₁线性层</span>
                                            <span class="text-xs text-gray-600">→ 4×d_model维</span>
                                        </div>
                                        <div class="text-center text-gray-400">↓</div>
                                        <div class="flex justify-between items-center bg-white p-2 rounded border">
                                            <span class="text-sm font-semibold">激活函数</span>
                                            <span class="text-xs text-gray-600">ReLU/GELU/SwiGLU</span>
                                        </div>
                                        <div class="text-center text-gray-400">↓</div>
                                        <div class="flex justify-between items-center bg-white p-2 rounded border">
                                            <span class="text-sm font-semibold">W₂线性层</span>
                                            <span class="text-xs text-gray-600">→ d_model维</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-gradient-to-r from-orange-100 to-yellow-100 p-4 rounded-lg border border-orange-200">
                                    <h5 class="font-bold text-orange-700 mb-2">🎯 核心作用</h5>
                                    <ul class="text-sm text-orange-600 space-y-1">
                                        <li>• <strong>特征提取:</strong> 发现复杂模式</li>
                                        <li>• <strong>非线性变换:</strong> 增强表达能力</li>
                                        <li>• <strong>信息整合:</strong> 融合注意力结果</li>
                                        <li>• <strong>记忆存储:</strong> 参数中存储知识</li>
                                    </ul>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                    <h5 class="font-bold text-blue-700 mb-2">💡 现代优化</h5>
                                    <ul class="text-sm text-blue-600 space-y-1">
                                        <li>• <strong>SwiGLU:</strong> 门控线性单元</li>
                                        <li>• <strong>GLU变体:</strong> 更好的梯度流</li>
                                        <li>• <strong>参数共享:</strong> 减少内存占用</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MoE组件详解 -->
                    <div id="component-moe" class="component-detail hidden">
                        <h4 class="text-xl font-bold mb-4 text-green-700">🎯 专家混合 (Mixture of Experts)</h4>
                        <div class="space-y-6">
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200">
                                <div class="text-center mb-4">
                                    <h5 class="font-bold text-green-700 text-lg">🚀 MoE革命性突破</h5>
                                    <p class="text-sm text-green-600 mt-2">用<strong>稀疏激活</strong>实现<strong>超大规模</strong>而<strong>计算高效</strong>的模型</p>
                                </div>
                                
                                <div class="grid md:grid-cols-3 gap-4 mb-4">
                                    <div class="bg-white p-4 rounded-lg border border-green-100">
                                        <div class="text-center">
                                            <div class="text-2xl mb-2">🎯</div>
                                            <h6 class="font-bold text-green-700">路由网络</h6>
                                            <p class="text-xs text-green-600 mt-1">决定激活哪些专家</p>
                                        </div>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg border border-green-100">
                                        <div class="text-center">
                                            <div class="text-2xl mb-2">👥</div>
                                            <h6 class="font-bold text-green-700">专家网络</h6>
                                            <p class="text-xs text-green-600 mt-1">独立的FFN专家</p>
                                        </div>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg border border-green-100">
                                        <div class="text-center">
                                            <div class="text-2xl mb-2">⚡</div>
                                            <h6 class="font-bold text-green-700">稀疏激活</h6>
                                            <p class="text-xs text-green-600 mt-1">只用少数专家</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white p-4 rounded-lg border border-gray-200">
                                    <h5 class="font-bold text-gray-700 mb-3">🔄 MoE工作流程</h5>
                                    <div class="space-y-3 text-sm">
                                        <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                            <div class="w-6 h-6 bg-green-200 rounded-full flex items-center justify-center text-xs font-bold">1</div>
                        <div>
                                                <span class="font-bold">路由选择</span><br>
                                                <span class="text-gray-600">根据输入选择Top-K个专家</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                            <div class="w-6 h-6 bg-green-200 rounded-full flex items-center justify-center text-xs font-bold">2</div>
                                            <div>
                                                <span class="font-bold">专家计算</span><br>
                                                <span class="text-gray-600">选中的专家并行处理</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-3 p-2 bg-gray-50 rounded">
                                            <div class="w-6 h-6 bg-green-200 rounded-full flex items-center justify-center text-xs font-bold">3</div>
                                            <div>
                                                <span class="font-bold">加权融合</span><br>
                                                <span class="text-gray-600">按路由权重合并结果</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-b from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                                    <h5 class="font-bold text-blue-700 mb-3">📊 MoE优势对比</h5>
                                    <div class="space-y-3 text-sm">
                                        <div class="bg-white p-2 rounded border text-center">
                                            <div class="font-bold text-gray-700">传统FFN</div>
                                            <div class="text-gray-600 text-xs">所有参数都参与计算</div>
                                        </div>
                                        <div class="text-center font-bold text-gray-500">VS</div>
                                        <div class="bg-green-100 p-2 rounded border text-center border-green-300">
                                            <div class="font-bold text-green-700">MoE FFN</div>
                                            <div class="text-green-600 text-xs">只激活少数专家参数</div>
                                        </div>
                                        <div class="mt-3 p-2 bg-yellow-100 rounded text-center border border-yellow-300">
                                            <span class="font-bold text-yellow-700">结果: 10倍参数 ≈ 1.2倍计算量</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <h5 class="font-bold text-yellow-700 mb-2">🏆 MoE成功案例</h5>
                                <div class="grid md:grid-cols-3 gap-4 text-sm">
                                    <div class="text-center">
                                        <div class="font-bold">Switch Transformer</div>
                                        <div class="text-yellow-600">Google, 1.6万亿参数</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-bold">GLaM</div>
                                        <div class="text-yellow-600">Google, 1.2万亿参数</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-bold">PaLM-2</div>
                                        <div class="text-yellow-600">Google, MoE架构</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 残差连接详解 -->
                    <div id="component-residual" class="component-detail hidden">
                        <h4 class="text-xl font-bold mb-4 text-indigo-700">🔗 残差连接 & 层归一化</h4>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                                    <h5 class="font-bold text-indigo-700 mb-2">🔄 残差连接</h5>
                                    <div class="bg-white p-3 rounded border font-mono text-sm text-center">
                                        输出 = F(x) + x
                                </div>
                                    <ul class="text-sm text-indigo-600 mt-3 space-y-1">
                                        <li>• <strong>梯度流动:</strong> 防止梯度消失</li>
                                        <li>• <strong>训练稳定:</strong> 更深网络训练</li>
                                        <li>• <strong>特征保留:</strong> 保持原始信息</li>
                                    </ul>
                            </div>
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                    <h5 class="font-bold text-green-700 mb-2">📏 层归一化</h5>
                                    <div class="bg-white p-3 rounded border font-mono text-sm text-center">
                                        LN(x) = γ × (x-μ)/σ + β
                        </div>
                                    <ul class="text-sm text-green-600 mt-3 space-y-1">
                                        <li>• <strong>数值稳定:</strong> 防止激活爆炸</li>
                                        <li>• <strong>加速收敛:</strong> 更快训练</li>
                                        <li>• <strong>减少依赖:</strong> 对初始化不敏感</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="bg-gradient-to-b from-indigo-100 to-purple-100 p-4 rounded-lg">
                                <h5 class="font-bold text-center mb-3">🏗️ 组合效果</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="bg-white p-2 rounded border text-center">输入 x</div>
                                    <div class="flex items-center gap-2">
                                        <div class="flex-1 bg-blue-100 p-2 rounded border text-center text-xs">子层 (MHA/FFN)</div>
                                        <div class="bg-gray-100 p-2 rounded border text-center text-xs">跳跃连接</div>
                                    </div>
                                    <div class="text-center text-xl font-bold">+</div>
                                    <div class="bg-green-100 p-2 rounded border text-center text-xs">层归一化</div>
                                    <div class="bg-white p-2 rounded border text-center">输出</div>
                                </div>
                                <div class="text-center mt-3 text-xs text-gray-600">
                                    每个子层都被残差连接和层归一化包装
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 完整的解码器层可视化 -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-2xl font-semibold mb-6 text-center">🔬 完整解码器层解析</h3>
                    <div class="max-w-2xl mx-auto">
                        <div class="space-y-4">
                            <!-- 输入 -->
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-300 text-center">
                                <div class="font-bold text-blue-700">输入向量 [seq_len, d_model]</div>
                            </div>
                            
                            <!-- 第一个子层：注意力 -->
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-300">
                                <div class="grid grid-cols-3 gap-2 items-center">
                                    <div class="bg-purple-100 p-3 rounded border border-purple-400 text-center">
                                        <div class="font-bold text-purple-700">🧠 MHA</div>
                                        <div class="text-xs text-purple-600">掩码注意力</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="bg-gray-200 w-8 h-8 rounded-full flex items-center justify-center font-bold text-gray-600 mx-auto">+</div>
                                        <div class="text-xs text-gray-600 mt-1">残差</div>
                                    </div>
                                    <div class="bg-indigo-100 p-3 rounded border border-indigo-400 text-center">
                                        <div class="font-bold text-indigo-700">🔗 LayerNorm</div>
                                        <div class="text-xs text-indigo-600">归一化</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 第二个子层：FFN/MoE -->
                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-300">
                                <div class="grid grid-cols-3 gap-2 items-center">
                                    <div class="bg-orange-100 p-3 rounded border border-orange-400 text-center">
                                        <div class="font-bold text-orange-700">⚡ FFN/MoE</div>
                                        <div class="text-xs text-orange-600">前馈网络</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="bg-gray-200 w-8 h-8 rounded-full flex items-center justify-center font-bold text-gray-600 mx-auto">+</div>
                                        <div class="text-xs text-gray-600 mt-1">残差</div>
                                    </div>
                                    <div class="bg-indigo-100 p-3 rounded border border-indigo-400 text-center">
                                        <div class="font-bold text-indigo-700">🔗 LayerNorm</div>
                                        <div class="text-xs text-indigo-600">归一化</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 输出 -->
                            <div class="bg-green-50 p-4 rounded-lg border border-green-300 text-center">
                                <div class="font-bold text-green-700">输出向量 [seq_len, d_model]</div>
                            </div>

                            <!-- 重复指示 -->
                            <div class="text-center">
                                <div class="bg-gradient-to-r from-indigo-100 to-purple-100 px-6 py-3 rounded-full border border-indigo-300 inline-block">
                                    <div class="font-bold text-indigo-700">⬆️ 重复 N 次 (如96层) ⬆️</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="decoder-journey" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-6 sm:mb-8 text-[#4338CA]">向量的深度之旅：一步一脚印</h2>
                <p class="text-xl leading-relaxed mb-8 text-gray-700">我们已经知道训练的核心是"预测-对比-修正"的循环。现在，让我们深入模型内部，用一个具体的数字例子，追踪 `an apple` 这两个词的向量，看看它们是如何一步步计算，最终预测出下一个词 `a` 的。</p>
                
                <!-- 训练过程控制面板 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                        <div class="flex items-center gap-4">
                            <button id="start-training" class="bg-[#4338CA] text-white px-4 sm:px-6 py-3 rounded-lg hover:bg-[#3730A3] transition font-semibold min-h-[44px] text-sm sm:text-base">开始训练演示</button>
                            <button id="next-step" class="bg-green-600 text-white px-4 sm:px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold hidden min-h-[44px] text-sm sm:text-base">下一步</button>
                            <button id="reset-training" class="bg-gray-200 text-gray-800 px-4 sm:px-6 py-3 rounded-lg hover:bg-gray-300 transition font-semibold min-h-[44px] text-sm sm:text-base">重置</button>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-sm text-gray-600">当前步骤:</div>
                            <div id="current-step" class="text-lg font-bold text-[#4338CA]">准备开始</div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm text-gray-500 mb-2">
                            <span>训练进度</span>
                            <span id="progress-text">0/9</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="progress-bar" class="bg-[#4338CA] h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div id="step-instruction" class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200 hidden">
                        <p class="text-blue-800 text-center">
                            <span class="font-semibold">💡 提示：</span>
                            <span id="instruction-text">点击"开始训练演示"来启动第一步</span>
                        </p>
                    </div>
                </div>
                
                <div class="space-y-8">
                    <div class="journey-step training-step" data-step="1" id="step-1">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第一步：初始向量 (Embeddings)</h3>
                        <p class="mb-4 text-gray-700">模型接收到 `an apple`，并从输入层查找到它们各自的初始向量。为了方便理解，我们假设向量只有4个维度。这些向量代表了词语的"基础含义"。</p>
                        <div class="flex justify-around p-4 bg-white rounded-xl border border-gray-200">
                            <div class="text-center vector-display" data-word="an">
                                <p class="font-semibold mb-2">Vector('an')</p>
                                <div class="math-box text-lg vector-animation">[1, 2, 0, 3]</div>
                            </div>
                            <div class="text-center vector-display" data-word="apple">
                                <p class="font-semibold mb-2">Vector('apple')</p>
                                <div class="math-box text-lg vector-animation">[4, 1, 5, 2]</div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="1">下一步 →</button>
                        </div>
                    </div>

                    <div class="journey-step training-step" data-step="2" id="step-2">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第二步：QKV线性变换</h3>
                        <p class="mb-4 text-gray-700">在自注意力层，模型有三个可学习的权重矩阵 W<sub>Q</sub>, W<sub>K</sub>, W<sub>V</sub>。每个输入向量都会与这三个矩阵相乘，生成三个新向量：<strong>Query</strong> (用于查询), <strong>Key</strong> (用于被查询), <strong>Value</strong> (携带信息)。</p>
                        <p class="text-center font-semibold text-lg my-4">以 `apple` 的向量 [4, 1, 5, 2] 为例：</p>
                        <div class="grid md:grid-cols-3 gap-4 text-center p-4 bg-white rounded-xl border border-gray-200">
                            <div class="qkv-transform" data-type="q">
                                <p class="font-bold mb-2">Query (查询)</p>
                                <div class="math-box mb-2">[4,1,5,2] * W<sub>Q</sub></div>
                                <div class="arch-arrow transform-arrow opacity-0 transition-opacity duration-500">↓</div>
                                <div class="math-box bg-blue-100 result-vector opacity-0 transform translate-y-4 transition-all duration-500">[5, 2, 8, 1]</div>
                            </div>
                            <div class="qkv-transform" data-type="k">
                                <p class="font-bold mb-2">Key (键)</p>
                                <div class="math-box mb-2">[4,1,5,2] * W<sub>K</sub></div>
                                <div class="arch-arrow transform-arrow opacity-0 transition-opacity duration-500">↓</div>
                                <div class="math-box bg-green-100 result-vector opacity-0 transform translate-y-4 transition-all duration-500">[3, 7, 2, 6]</div>
                            </div>
                            <div class="qkv-transform" data-type="v">
                                <p class="font-bold mb-2">Value (值)</p>
                                <div class="math-box mb-2">[4,1,5,2] * W<sub>V</sub></div>
                                <div class="arch-arrow transform-arrow opacity-0 transition-opacity duration-500">↓</div>
                                <div class="math-box bg-yellow-100 result-vector opacity-0 transform translate-y-4 transition-all duration-500">[9, 4, 0, 5]</div>
                            </div>
                        </div>
                         <p class="mt-4 text-center text-sm text-gray-600">(注：`an`的向量 [1,2,0,3] 也在并行地进行完全相同的变换)</p>
                        
                        <!-- QKV文字含义解释 -->
                        <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                            <h4 class="text-xl font-semibold mb-4 text-center text-indigo-800">💡 QKV向量的文字含义理解</h4>
                            <div class="grid md:grid-cols-3 gap-4 text-sm">
                                <div class="bg-white p-3 rounded-lg border border-blue-100">
                                    <p class="font-bold text-blue-700 mb-2">🔍 Query (查询向量)</p>
                                    <p class="text-blue-600 mb-2"><strong>[5, 2, 8, 1]</strong></p>
                                    <p class="text-gray-700">代表"apple"的<strong>需求特征</strong>：</p>
                                    <ul class="text-xs text-gray-600 mt-1 space-y-1">
                                        <li>• "我需要什么样的上下文？"</li>
                                        <li>• "我关心什么语义信息？"</li>
                                        <li>• 类似：<em>"水果+形容词"</em></li>
                                    </ul>
                                </div>
                                <div class="bg-white p-3 rounded-lg border border-green-100">
                                    <p class="font-bold text-green-700 mb-2">🔑 Key (键向量)</p>
                                    <p class="text-green-600 mb-2"><strong>[3, 7, 2, 6]</strong></p>
                                    <p class="text-gray-700">代表"apple"的<strong>索引特征</strong>：</p>
                                    <ul class="text-xs text-gray-600 mt-1 space-y-1">
                                        <li>• "我能提供什么信息？"</li>
                                        <li>• "我有什么特征标签？"</li>
                                        <li>• 类似：<em>"名词+可数+食物"</em></li>
                                    </ul>
                                </div>
                                <div class="bg-white p-3 rounded-lg border border-yellow-100">
                                    <p class="font-bold text-yellow-700 mb-2">💎 Value (值向量)</p>
                                    <p class="text-yellow-600 mb-2"><strong>[9, 4, 0, 5]</strong></p>
                                    <p class="text-gray-700">代表"apple"的<strong>内容信息</strong>：</p>
                                    <ul class="text-xs text-gray-600 mt-1 space-y-1">
                                        <li>• "我的实际语义内容是什么？"</li>
                                        <li>• "我要传递给其他词的信息"</li>
                                        <li>• 类似：<em>"红色+甜味+圆形"</em></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-white rounded-lg border border-gray-200">
                                <p class="text-center text-sm text-gray-700">
                                    <span class="font-semibold text-indigo-700">🎯 核心理解：</span>
                                    Query问"我想要什么"，Key答"我能给什么"，Value提供"实际内容"。
                                    <br>通过Q·K计算相似度，决定要多少V的信息融入到新的上下文向量中。
                                </p>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="2">下一步 →</button>
                        </div>
                    </div>

                    <div class="journey-step training-step" data-step="3" id="step-3">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第三步：计算注意力分数</h3>
                        <p class="mb-4 text-gray-700">为了更新 `apple` 位置的向量，模型会用 `apple` 的<strong>Query</strong>向量，去和所有它能看到的词（`an` 和 `apple` 自身）的<strong>Key</strong>向量做点积运算，得到原始的"注意力分数"。</p>
                        <div class="grid md:grid-cols-2 gap-4 text-center p-4 bg-white rounded-xl border border-gray-200">
                            <div class="attention-calc" data-pair="an">
                                <p class="font-semibold mb-2">Q('apple') • K('an')</p>
                                <p class="text-sm text-gray-500 mb-2">(假设K('an')为[1,4,2,3])</p>
                                <div class="dot-product-visual mb-2">
                                    <div class="flex justify-center items-center gap-2 text-sm">
                                        <span class="math-element opacity-0 transition-opacity duration-500">[5×1</span>
                                        <span class="math-element opacity-0 transition-opacity duration-500">+ 2×4</span>
                                        <span class="math-element opacity-0 transition-opacity duration-500">+ 8×2</span>
                                        <span class="math-element opacity-0 transition-opacity duration-500">+ 1×3]</span>
                                    </div>
                                </div>
                                <div class="math-box attention-score opacity-0 transform scale-75 transition-all duration-500">32</div>
                                <div class="mt-2 w-full bg-gray-200 rounded-full h-3">
                                    <div class="attention-bar bg-orange-400 h-3 rounded-full transition-all duration-1000" style="width: 0%;" data-width="64%"></div>
                                </div>
                            </div>
                            <div class="attention-calc" data-pair="apple">
                                <p class="font-semibold mb-2">Q('apple') • K('apple')</p>
                                <p class="text-sm text-gray-500 mb-2">(K('apple')来自上一步)</p>
                                <div class="dot-product-visual mb-2">
                                    <div class="flex justify-center items-center gap-2 text-sm">
                                        <span class="math-element opacity-0 transition-opacity duration-500">[5×3</span>
                                        <span class="math-element opacity-0 transition-opacity duration-500">+ 2×7</span>
                                        <span class="math-element opacity-0 transition-opacity duration-500">+ 8×2</span>
                                        <span class="math-element opacity-0 transition-opacity duration-500">+ 1×6]</span>
                                    </div>
                                </div>
                                <div class="math-box attention-score opacity-0 transform scale-75 transition-all duration-500">51</div>
                                <div class="mt-2 w-full bg-gray-200 rounded-full h-3">
                                    <div class="attention-bar bg-red-400 h-3 rounded-full transition-all duration-1000" style="width: 0%;" data-width="100%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 p-4 bg-indigo-50 rounded-xl border border-indigo-200">
                            <p class="text-gray-700 mb-2">然后，为了防止梯度爆炸，分数需要除以Key向量维度的平方根（√4=2）。</p>
                            <div class="text-center">
                               <div class="math-box scaling-result opacity-0 transform translate-y-2 transition-all duration-500">Scaled Scores = [32/2, 51/2] = [16, 25.5]</div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="3">下一步 →</button>
                        </div>
                    </div>
                    
                    <div class="journey-step training-step" data-step="4" id="step-4">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第四步：Softmax归一化</h3>
                        <p class="mb-4 text-gray-700">Softmax函数会将缩放后的分数转换为0到1之间、总和为1的权重。它通过计算每个分数的指数，然后除以所有分数的指数之和来完成。</p>
                        <div class="p-4 bg-white rounded-xl border border-gray-200">
                            <div class="softmax-visual space-y-6">
                                <div class="softmax-step opacity-0 transition-all duration-500" id="softmax-step-1">
                                    <p class="font-semibold text-lg mb-3">1. 输入数据（缩放后的注意力分数）:</p>
                                    <div class="text-center">
                                        <div class="math-box text-lg bg-gray-100">输入: [16, 25.5]</div>
                                    </div>
                                </div>
                                
                                <div class="softmax-step opacity-0 transition-all duration-500" id="softmax-step-2">
                                    <p class="font-semibold text-lg mb-3">2. 计算每个元素的指数（防止数值溢出）:</p>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div class="text-center p-3 bg-orange-50 rounded-lg">
                                            <p class="font-semibold text-orange-800">对于分数 16:</p>
                                            <div class="math-box mt-2">e<sup>16</sup></div>
                                            <p class="text-sm mt-1">= 2.718...<sup>16</sup></p>
                                            <div class="math-element mt-2 text-lg">≈ 8,886,110</div>
                                        </div>
                                        <div class="text-center p-3 bg-green-50 rounded-lg">
                                            <p class="font-semibold text-green-800">对于分数 25.5:</p>
                                            <div class="math-box mt-2">e<sup>25.5</sup></div>
                                            <p class="text-sm mt-1">= 2.718...<sup>25.5</sup></p>
                                            <div class="math-element mt-2 text-lg">≈ 116,191,670,000</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="softmax-step opacity-0 transition-all duration-500" id="softmax-step-3">
                                    <p class="font-semibold text-lg mb-3">3. 计算所有指数的总和:</p>
                                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                                        <div class="math-box text-lg">总和 = 8,886,110 + 116,191,670,000</div>
                                        <div class="math-element mt-3 text-xl font-bold">≈ 116,200,556,110</div>
                                        <p class="text-sm mt-2 text-gray-600">（注意第二个数值远大于第一个）</p>
                                    </div>
                                </div>
                                
                                <div class="softmax-step opacity-0 transition-all duration-500" id="softmax-step-4">
                                    <p class="font-semibold text-lg mb-3">4. 计算最终概率（每个指数除以总和）:</p>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div class="text-center p-3 bg-orange-50 rounded-lg">
                                            <p class="font-semibold text-orange-800">P(关注"an")</p>
                                            <div class="math-box mt-2">8,886,110 ÷ 116,200,556,110</div>
                                            <div class="math-element mt-2">= 0.0000765</div>
                                            <div class="weight-display bg-orange-100 text-orange-800 mt-2">≈ 0.00008 (0.008%)</div>
                                            <div class="w-full bg-gray-200 rounded-full h-4 mt-2">
                                                <div class="bg-orange-400 h-4 rounded-full transition-all duration-1000" style="width: 0%;" data-width="0.1%"></div>
                                            </div>
                                        </div>
                                        <div class="text-center p-3 bg-green-50 rounded-lg">
                                            <p class="font-semibold text-green-800">P(关注"apple")</p>
                                            <div class="math-box mt-2">116,191,670,000 ÷ 116,200,556,110</div>
                                            <div class="math-element mt-2">= 0.9999235</div>
                                            <div class="weight-display bg-green-100 text-green-800 mt-2">≈ 0.99992 (99.992%)</div>
                                            <div class="w-full bg-gray-200 rounded-full h-4 mt-2">
                                                <div class="bg-green-400 h-4 rounded-full transition-all duration-1000" style="width: 0%;" data-width="99.9%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="softmax-step opacity-0 transition-all duration-500" id="softmax-step-5">
                                    <p class="font-semibold text-lg mb-3">5. 验证结果（概率总和必须等于1）:</p>
                                    <div class="text-center p-4 bg-indigo-50 rounded-lg">
                                        <div class="math-box text-lg">0.00008 + 0.99992 = 1.00000 ✓</div>
                                        <p class="mt-3 text-indigo-800 font-semibold">最终注意力权重: [0.00008, 0.99992]</p>
                                    </div>
                                </div>
                                
                                <div class="softmax-step opacity-0 transition-all duration-500" id="softmax-result">
                                    <div class="p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border-2 border-purple-200">
                                        <p class="font-bold text-lg text-center text-purple-800 mb-2">🎯 Softmax的核心作用</p>
                                        <p class="text-center text-purple-700">将任意实数转换为有效的概率分布，突出最重要的信息，同时保持所有概率之和为1。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-4 text-center font-semibold text-indigo-700">这表明，在 `apple` 这个位置，模型几乎将100%的注意力放在 `apple` 自身。</p>
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="4">下一步 →</button>
                        </div>
                    </div>

                    <div class="journey-step training-step" data-step="5" id="step-5">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第五步：生成上下文向量</h3>
                        <p class="mb-4 text-gray-700">模型用上一步得到的注意力权重，去对<strong>所有词</strong>的<strong>Value</strong>向量进行加权求和，得到一个全新的、融合了上下文信息的向量。这个新向量将作为`apple`位置的输出，传递给下一层或FFN。</p>
                        <div class="p-4 bg-white rounded-xl border border-gray-200">
                            <div class="context-computation space-y-4">
                                <div class="computation-step opacity-0 transition-all duration-500" id="computation-formula">
                                    <p class="font-semibold text-lg text-center">New Vector('apple') = 0.00 * V('an') + 1.00 * V('apple')</p>
                                </div>
                                <div class="computation-step opacity-0 transition-all duration-500" id="computation-detail">
                                    <p class="text-sm text-center text-gray-500">(假设V('an')为[2,6,1,7])</p>
                                    <div class="grid md:grid-cols-3 gap-4 mt-4">
                                        <div class="text-center">
                                            <p class="font-semibold">V('an') × 0.00</p>
                                            <div class="math-box">[2,6,1,7] × 0.00</div>
                                            <div class="math-box mt-2 bg-orange-100">[0,0,0,0]</div>
                                        </div>
                                        <div class="text-center">
                                            <p class="font-semibold">V('apple') × 1.00</p>
                                            <div class="math-box">[9,4,0,5] × 1.00</div>
                                            <div class="math-box mt-2 bg-green-100">[9,4,0,5]</div>
                                        </div>
                                        <div class="text-center">
                                            <p class="font-semibold">最终结果</p>
                                            <div class="math-box">[0,0,0,0] + [9,4,0,5]</div>
                                            <div class="math-box mt-2 bg-indigo-100 font-bold">[9,4,0,5]</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="computation-step opacity-0 transition-all duration-500" id="computation-result">
                                    <div class="text-center p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                                        <p class="font-bold text-indigo-700 text-lg">这个 [9, 4, 0, 5] 就是在`apple`位置上，融合了`an apple`上下文的新向量！</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="5">下一步 →</button>
                        </div>
                    </div>



                    <div class="journey-step training-step" data-step="6" id="step-6">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第六步：FFN非线性变换</h3>
                        <p class="mb-4 text-gray-700">自注意力层输出的向量还需要经过前馈神经网络（FFN）进行非线性变换，进一步提炼和加工信息。FFN通常包含两个线性变换和一个激活函数。</p>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-xl border border-gray-200">
                                <h4 class="text-xl font-semibold mb-4 text-center">FFN结构</h4>
                                <div class="ffn-structure space-y-4">
                                    <div class="ffn-step opacity-0 transition-all duration-500" id="ffn-input">
                                        <div class="text-center">
                                            <p class="font-semibold">输入（来自注意力层）</p>
                                            <div class="math-box bg-indigo-100">[9, 4, 0, 5]</div>
                                        </div>
                                    </div>
                                    <div class="ffn-step opacity-0 transition-all duration-500" id="ffn-linear1">
                                        <div class="text-center">
                                            <div class="arch-arrow">↓</div>
                                            <p class="font-semibold">第一个线性变换 (W₁)</p>
                                            <div class="math-box">[9,4,0,5] × W₁ → 扩展到更高维度</div>
                                            <div class="math-box bg-blue-100 mt-2">[15, 8, 12, 6, 20, 3, 18, 9]</div>
                                            <p class="text-sm text-gray-500 mt-1">通常扩展到4倍维度（4→16维）</p>
                                        </div>
                                    </div>
                                    <div class="ffn-step opacity-0 transition-all duration-500" id="ffn-activation">
                                        <div class="text-center">
                                            <div class="arch-arrow">↓</div>
                                            <p class="font-semibold">ReLU激活函数</p>
                                            <div class="math-box">ReLU(x) = max(0, x)</div>
                                            <div class="grid grid-cols-4 gap-1 mt-2">
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">15→15</div>
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">8→8</div>
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">12→12</div>
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">6→6</div>
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">20→20</div>
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">3→3</div>
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">18→18</div>
                                                <div class="activation-demo bg-green-100 p-1 rounded text-xs">9→9</div>
                                            </div>
                                            <p class="text-sm text-gray-500 mt-1">所有值都>0，保持不变</p>
                                        </div>
                                    </div>
                                    <div class="ffn-step opacity-0 transition-all duration-500" id="ffn-linear2">
                                        <div class="text-center">
                                            <div class="arch-arrow">↓</div>
                                            <p class="font-semibold">第二个线性变换 (W₂)</p>
                                            <div class="math-box">[15,8,12,6,20,3,18,9] × W₂</div>
                                            <div class="math-box bg-purple-100 mt-2">[11, 6, 2, 8]</div>
                                            <p class="text-sm text-gray-500 mt-1">压缩回原始维度</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-200">
                                <h4 class="text-xl font-semibold mb-4 text-center">残差连接 & 层归一化</h4>
                                <div class="residual-demo space-y-4">
                                    <div class="residual-step opacity-0 transition-all duration-500" id="residual-add">
                                        <p class="font-semibold text-center mb-3">残差连接 (Residual Connection)</p>
                                        <div class="text-center">
                                            <div class="math-box bg-indigo-100">原始输入: [9, 4, 0, 5]</div>
                                            <div class="text-xl my-2">+</div>
                                            <div class="math-box bg-purple-100">FFN输出: [11, 6, 2, 8]</div>
                                            <div class="arch-arrow">↓</div>
                                            <div class="math-box bg-green-100 font-bold">[20, 10, 2, 13]</div>
                                        </div>
                                        <p class="text-sm text-gray-600 text-center mt-2">防止梯度消失，保留原始信息</p>
                                    </div>
                                    <div class="residual-step opacity-0 transition-all duration-500" id="layer-norm">
                                        <p class="font-semibold text-center mb-3">层归一化 (Layer Normalization)</p>
                                        <div class="text-center space-y-2">
                                            <div class="math-box">均值: μ = (20+10+2+13)/4 = 11.25</div>
                                            <div class="math-box">方差: σ² = 计算各元素与均值差的平方和</div>
                                            <div class="math-box">归一化: (x - μ) / √(σ² + ε)</div>
                                            <div class="math-box bg-yellow-100 font-bold">最终输出: [1.2, -0.3, -1.8, 0.9]</div>
                                        </div>
                                        <p class="text-sm text-gray-600 text-center mt-2">稳定训练，加速收敛</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FFN详细计算示例 -->
                        <div class="mt-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200">
                            <h4 class="text-xl font-semibold mb-4 text-center text-purple-800">🧮 FFN详细计算示例</h4>
                            <div class="space-y-6">
                                <!-- W1计算 -->
                                <div class="bg-white p-4 rounded-lg border border-purple-100">
                                    <h5 class="font-bold text-purple-700 mb-3">🔢 第一步：W₁线性变换（扩展维度）</h5>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm text-gray-700 mb-2">输入向量（4维）：</p>
                                            <div class="math-box bg-indigo-100 text-center">[9, 4, 0, 5]</div>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-700 mb-2">W₁权重矩阵（4×8，简化展示）：</p>
                                            <div class="text-xs bg-gray-100 p-2 rounded font-mono">
                                                [1.2  0.8  1.5  0.3  2.1  0.1  1.8  0.9]<br>
                                                [0.5  1.3  0.7  1.1  0.4  1.6  0.2  1.4]<br>
                                                [1.0  0.6  1.9  0.8  1.7  0.5  1.3  0.7]<br>
                                                [0.9  1.1  0.4  1.8  0.6  1.2  0.8  1.5]
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3 text-center">
                                        <p class="text-sm text-gray-600 mb-2">矩阵乘法计算：</p>
                                        <div class="text-xs bg-blue-50 p-3 rounded border">
                                            <div class="grid grid-cols-4 gap-2 text-center">
                                                <div>9×1.2 + 4×0.5 + 0×1.0 + 5×0.9 = <strong>15.3</strong></div>
                                                <div>9×0.8 + 4×1.3 + 0×0.6 + 5×1.1 = <strong>17.9</strong></div>
                                                <div>9×1.5 + 4×0.7 + 0×1.9 + 5×0.4 = <strong>16.3</strong></div>
                                                <div>9×0.3 + 4×1.1 + 0×0.8 + 5×1.8 = <strong>15.1</strong></div>
                                            </div>
                                            <div class="grid grid-cols-4 gap-2 text-center mt-2">
                                                <div>9×2.1 + 4×0.4 + 0×1.7 + 5×0.6 = <strong>22.5</strong></div>
                                                <div>9×0.1 + 4×1.6 + 0×0.5 + 5×1.2 = <strong>12.3</strong></div>
                                                <div>9×1.8 + 4×0.2 + 0×1.3 + 5×0.8 = <strong>21.0</strong></div>
                                                <div>9×0.9 + 4×1.4 + 0×0.7 + 5×1.5 = <strong>21.2</strong></div>
                                            </div>
                                        </div>
                                        <div class="math-box bg-blue-100 mt-2 font-bold">[15.3, 17.9, 16.3, 15.1, 22.5, 12.3, 21.0, 21.2]</div>
                                    </div>
                                </div>
                                
                                <!-- ReLU计算 -->
                                <div class="bg-white p-4 rounded-lg border border-green-100">
                                    <h5 class="font-bold text-green-700 mb-3">⚡ 第二步：ReLU激活函数</h5>
                                    <div class="text-center">
                                        <p class="text-sm text-gray-700 mb-2">ReLU函数：f(x) = max(0, x)</p>
                                        <div class="grid grid-cols-4 gap-2 text-sm">
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>15.3 → <strong>15.3</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>17.9 → <strong>17.9</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>16.3 → <strong>16.3</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>15.1 → <strong>15.1</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-4 gap-2 text-sm mt-2">
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>22.5 → <strong>22.5</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>12.3 → <strong>12.3</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>21.0 → <strong>21.0</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                            <div class="bg-green-50 p-2 rounded border">
                                                <div>21.2 → <strong>21.2</strong></div>
                                                <div class="text-xs text-green-600">正数保持</div>
                                            </div>
                                        </div>
                                        <div class="math-box bg-green-100 mt-3 font-bold">[15.3, 17.9, 16.3, 15.1, 22.5, 12.3, 21.0, 21.2]</div>
                                        <p class="text-xs text-gray-500 mt-1">本例中所有值都为正，ReLU不改变值</p>
                                    </div>
                                </div>
                                
                                <!-- W2计算 -->
                                <div class="bg-white p-4 rounded-lg border border-purple-100">
                                    <h5 class="font-bold text-purple-700 mb-3">🔄 第三步：W₂线性变换（压缩维度）</h5>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm text-gray-700 mb-2">ReLU输出（8维）：</p>
                                            <div class="math-box bg-green-100 text-xs">[15.3, 17.9, 16.3, 15.1, 22.5, 12.3, 21.0, 21.2]</div>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-700 mb-2">W₂权重矩阵（8×4，简化展示）：</p>
                                            <div class="text-xs bg-gray-100 p-2 rounded font-mono">
                                                [0.8  0.3  -0.1  0.6]<br>
                                                [0.4  0.9   0.2  0.1]<br>
                                                [0.7  0.1   0.8  0.3]<br>
                                                [0.2  0.6   0.4  0.7]<br>
                                                [0.5  0.4   0.3  0.8]<br>
                                                [0.9  0.2   0.6  0.4]<br>
                                                [0.3  0.7   0.5  0.2]<br>
                                                [0.6  0.5   0.1  0.9]
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3 text-center">
                                        <p class="text-sm text-gray-600 mb-2">最终输出计算（8维→4维）：</p>
                                        <div class="text-xs bg-purple-50 p-3 rounded border space-y-1">
                                            <div><strong>输出[0]</strong> = 15.3×0.8 + 17.9×0.4 + 16.3×0.7 + 15.1×0.2 + 22.5×0.5 + 12.3×0.9 + 21.0×0.3 + 21.2×0.6 = <strong>68.4</strong></div>
                                            <div><strong>输出[1]</strong> = 15.3×0.3 + 17.9×0.9 + 16.3×0.1 + 15.1×0.6 + 22.5×0.4 + 12.3×0.2 + 21.0×0.7 + 21.2×0.5 = <strong>72.1</strong></div>
                                            <div><strong>输出[2]</strong> = 15.3×(-0.1) + 17.9×0.2 + 16.3×0.8 + 15.1×0.4 + 22.5×0.3 + 12.3×0.6 + 21.0×0.5 + 21.2×0.1 = <strong>48.9</strong></div>
                                            <div><strong>输出[3]</strong> = 15.3×0.6 + 17.9×0.1 + 16.3×0.3 + 15.1×0.7 + 22.5×0.8 + 12.3×0.4 + 21.0×0.2 + 21.2×0.9 = <strong>75.3</strong></div>
                                        </div>
                                        <div class="math-box bg-purple-100 mt-2 font-bold">[68.4, 72.1, 48.9, 75.3]</div>
                                    </div>
                                </div>
                                
                                <!-- 总结 -->
                                <div class="bg-gradient-to-r from-indigo-100 to-purple-100 p-4 rounded-lg border border-indigo-200">
                                    <p class="text-center text-sm text-indigo-800">
                                        <span class="font-semibold">🎯 FFN核心作用：</span>
                                        通过 <strong>扩展→激活→压缩</strong> 的过程，让模型能够学习更复杂的非线性特征变换。
                                        <br>W₁扩展特征空间，ReLU引入非线性，W₂整合信息并压缩回原维度。
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="6">下一步 →</button>
                        </div>
                    </div>

                    <div class="journey-step training-step" data-step="7" id="step-7">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第七步：损失函数与梯度计算</h3>
                        <p class="mb-4 text-gray-700">模型预测出错后，需要通过损失函数量化误差，然后计算梯度来指导参数更新。让我们详细看看这个过程。</p>
                        <div class="space-y-6">
                            <div class="bg-white p-6 rounded-xl border border-gray-200">
                                <h4 class="text-xl font-semibold mb-4 text-center">交叉熵损失函数详解</h4>
                                <div class="loss-calculation space-y-4">
                                    <div class="loss-step opacity-0 transition-all duration-500" id="loss-prediction">
                                        <p class="font-semibold text-center mb-3">1. 模型预测概率分布</p>
                                        <div class="grid md:grid-cols-3 gap-4">
                                            <div class="text-center p-3 bg-red-50 rounded-lg">
                                                <p class="font-semibold text-red-800">P("a") = 0.05</p>
                                                <p class="text-sm">目标词概率</p>
                                            </div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg">
                                                <p class="font-semibold">P("the") = 0.15</p>
                                                <p class="text-sm">其他高频词</p>
                                            </div>
                                            <div class="text-center p-3 bg-gray-50 rounded-lg">
                                                <p class="font-semibold">P(其他) = 0.80</p>
                                                <p class="text-sm">其余词汇</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="loss-step opacity-0 transition-all duration-500" id="loss-formula">
                                        <p class="font-semibold text-center mb-3">2. 交叉熵损失公式</p>
                                        <div class="text-center space-y-2">
                                            <div class="math-box text-lg">Loss = -log(P(正确答案))</div>
                                            <div class="math-box">Loss = -log(0.05)</div>
                                            <div class="math-box">Loss = -(-2.996) = 2.996</div>
                                            <div class="math-box bg-red-100 font-bold text-lg">Loss ≈ 3.0</div>
                                        </div>
                                        <p class="text-sm text-gray-600 text-center mt-2">预测概率越低，损失越大</p>
                                    </div>
                                    <div class="loss-step opacity-0 transition-all duration-500" id="loss-meaning">
                                        <div class="p-4 bg-blue-50 rounded-lg">
                                            <p class="font-semibold text-blue-800 text-center mb-2">💡 损失函数的意义</p>
                                            <ul class="text-blue-700 space-y-1">
                                                <li>• <strong>完美预测</strong>：P=1 → Loss=0</li>
                                                <li>• <strong>随机猜测</strong>：P=0.1 → Loss=2.3</li>
                                                <li>• <strong>错误预测</strong>：P=0.01 → Loss=4.6</li>
                                                <li>• <strong>完全错误</strong>：P→0 → Loss→∞</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="7">下一步 →</button>
                        </div>
                    </div>

                    <div class="journey-step training-step" data-step="8" id="step-8">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第八步：反向传播与梯度计算</h3>
                        <p class="mb-4 text-gray-700">损失函数告诉我们"错了多少"，但要知道"如何改正"，就需要计算梯度。梯度指出了每个参数应该往哪个方向、调整多少才能减少损失。</p>
                        <div class="space-y-6">
                            <div class="bg-white p-6 rounded-xl border border-gray-200">
                                <h4 class="text-xl font-semibold mb-4 text-center">链式法则：从输出到输入的梯度传播</h4>
                                <div class="backprop-flow space-y-4">
                                    <div class="backprop-step opacity-0 transition-all duration-500" id="backprop-output">
                                        <div class="text-center p-4 bg-red-50 rounded-lg">
                                            <p class="font-semibold text-red-800">🎯 输出层梯度（起点）</p>
                                            <div class="math-box">∂Loss/∂logits = [预测概率 - 真实标签]</div>
                                            <div class="math-box bg-red-100">∂L/∂logits = [0.05-1, 0.15-0, ...] = [-0.95, 0.15, ...]</div>
                                            <p class="text-sm text-gray-600 mt-2">损失对输出的梯度，反向传播的起点</p>
                                        </div>
                                    </div>
                                    <div class="backprop-step opacity-0 transition-all duration-500" id="backprop-ffn">
                                        <div class="text-center py-2">
                                            <div class="inline-flex items-center gap-2 bg-indigo-100 px-4 py-1 rounded-full">
                                                <span class="text-indigo-800 font-semibold">梯度向前层传播</span>
                                                <span class="text-2xl text-indigo-600">⬆️</span>
                                            </div>
                                        </div>
                                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                                            <p class="font-semibold text-purple-800">FFN层梯度计算</p>
                                            <div class="math-box">∂Loss/∂W₂ = 输入 ⊗ 上游梯度</div>
                                            <div class="math-box">∂Loss/∂W₁ = ReLU'(x) ⊙ (W₂ᵀ × 上游梯度)</div>
                                            <p class="text-sm text-gray-600 mt-1">⊗表示外积，⊙表示逐元素乘法</p>
                                        </div>
                                    </div>
                                    <div class="backprop-step opacity-0 transition-all duration-500" id="backprop-attention">
                                        <div class="text-center py-2">
                                            <div class="inline-flex items-center gap-2 bg-indigo-100 px-4 py-1 rounded-full">
                                                <span class="text-indigo-800 font-semibold">继续向前传播</span>
                                                <span class="text-2xl text-indigo-600">⬆️</span>
                                            </div>
                                        </div>
                                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                                            <p class="font-semibold text-blue-800">注意力层梯度计算</p>
                                            <div class="space-y-2">
                                                <div class="math-box">∂Loss/∂V = Attention_weights ⊗ 上游梯度</div>
                                                <div class="math-box">∂Loss/∂Attention = V ⊗ 上游梯度</div>
                                                <div class="math-box">∂Loss/∂Q,K = Softmax梯度 × ∂Attention/∂Q,K</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="backprop-step opacity-0 transition-all duration-500" id="backprop-weights">
                                        <div class="text-center py-2">
                                            <div class="inline-flex items-center gap-2 bg-indigo-100 px-4 py-1 rounded-full">
                                                <span class="text-indigo-800 font-semibold">到达权重层</span>
                                                <span class="text-2xl text-indigo-600">⬆️</span>
                                            </div>
                                        </div>
                                        <div class="text-center p-4 bg-green-50 rounded-lg">
                                            <p class="font-semibold text-green-800">🎯 权重矩阵梯度（终点）</p>
                                            <div class="grid md:grid-cols-3 gap-2">
                                                <div class="math-box bg-green-100">∂Loss/∂W_Q</div>
                                                <div class="math-box bg-green-100">∂Loss/∂W_K</div>
                                                <div class="math-box bg-green-100">∂Loss/∂W_V</div>
                                            </div>
                                            <p class="text-sm text-gray-600 mt-2">每个权重都知道了自己的"责任"</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="8">下一步 →</button>
                        </div>
                    </div>

                    <div class="journey-step training-step" data-step="9" id="step-9">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第九步：权重更新与优化</h3>
                        <p class="mb-4 text-gray-700">有了梯度，就可以更新权重了。现代深度学习使用Adam等优化器，它比简单的梯度下降更智能，能够自适应地调整学习率。</p>
                        <div class="space-y-6">
                            <div class="bg-white p-6 rounded-xl border border-gray-200">
                                <h4 class="text-xl font-semibold mb-4 text-center">Adam优化器更新过程</h4>
                                <div class="optimizer-demo space-y-4">
                                    <div class="optimizer-step opacity-0 transition-all duration-500" id="adam-gradients">
                                        <p class="font-semibold text-center mb-3">1. 计算梯度统计量</p>
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div class="p-3 bg-blue-50 rounded-lg">
                                                <p class="font-semibold text-blue-800">一阶矩估计 (动量)</p>
                                                <div class="math-box">m = β₁ × m_prev + (1-β₁) × ∇W</div>
                                                <p class="text-sm text-gray-600">β₁ = 0.9，记住梯度方向</p>
                                            </div>
                                            <div class="p-3 bg-green-50 rounded-lg">
                                                <p class="font-semibold text-green-800">二阶矩估计 (自适应)</p>
                                                <div class="math-box">v = β₂ × v_prev + (1-β₂) × (∇W)²</div>
                                                <p class="text-sm text-gray-600">β₂ = 0.999，记住梯度大小</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="optimizer-step opacity-0 transition-all duration-500" id="adam-correction">
                                        <p class="font-semibold text-center mb-3">2. 偏差修正</p>
                                        <div class="text-center space-y-2">
                                            <div class="math-box">m̂ = m / (1 - β₁ᵗ)</div>
                                            <div class="math-box">v̂ = v / (1 - β₂ᵗ)</div>
                                            <p class="text-sm text-gray-600">t是当前训练步数，修正初始偏差</p>
                                        </div>
                                    </div>
                                    <div class="optimizer-step opacity-0 transition-all duration-500" id="adam-update">
                                        <p class="font-semibold text-center mb-3">3. 权重更新</p>
                                        <div class="text-center space-y-2">
                                            <div class="math-box text-lg">W_new = W_old - α × m̂ / (√v̂ + ε)</div>
                                            <div class="p-3 bg-yellow-50 rounded-lg">
                                                <p class="text-sm text-gray-700">
                                                    <strong>α</strong> = 学习率 (如0.001)<br>
                                                    <strong>ε</strong> = 防止除零的小常数 (如1e-8)
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-gray-200">
                                <h4 class="text-xl font-semibold mb-4 text-center">三大权重矩阵的具体更新</h4>
                                <div class="weight-updates space-y-4">
                                    <div class="weight-update opacity-0 transition-all duration-500" id="update-wq">
                                        <div class="p-4 bg-blue-50 rounded-lg">
                                            <p class="font-semibold text-blue-800 text-center">W_Q 更新示例</p>
                                            <div class="text-center space-y-2">
                                                <div class="math-box">当前值: W_Q[0,0] = 0.5</div>
                                                <div class="math-box">梯度: ∇W_Q[0,0] = -0.02</div>
                                                <div class="math-box">更新后: W_Q[0,0] = 0.5 - 0.001 × (-0.02) = 0.50002</div>
                                            </div>
                                            <p class="text-sm text-gray-600 text-center mt-2">微小但精确的调整</p>
                                        </div>
                                    </div>
                                    <div class="weight-update opacity-0 transition-all duration-500" id="update-wk">
                                        <div class="p-4 bg-green-50 rounded-lg">
                                            <p class="font-semibold text-green-800 text-center">W_K 更新示例</p>
                                            <div class="text-center space-y-2">
                                                <div class="math-box">当前值: W_K[1,2] = -0.3</div>
                                                <div class="math-box">梯度: ∇W_K[1,2] = 0.015</div>
                                                <div class="math-box">更新后: W_K[1,2] = -0.3 - 0.001 × 0.015 = -0.300015</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="weight-update opacity-0 transition-all duration-500" id="update-wv">
                                        <div class="p-4 bg-purple-50 rounded-lg">
                                            <p class="font-semibold text-purple-800 text-center">W_V 更新示例</p>
                                            <div class="text-center space-y-2">
                                                <div class="math-box">当前值: W_V[2,1] = 0.8</div>
                                                <div class="math-box">梯度: ∇W_V[2,1] = -0.008</div>
                                                <div class="math-box">更新后: W_V[2,1] = 0.8 - 0.001 × (-0.008) = 0.800008</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 text-center">
                            <button class="step-next-btn bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition font-semibold hidden" data-step="9">🎉 完成完整训练循环</button>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="inference" class="content-section">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-6 sm:mb-8 text-[#4338CA]">推理过程：从输入到输出的生成之旅</h2>
                <p class="text-xl leading-relaxed mb-8 text-gray-700">推理（Inference）是使用训练好的模型来生成新文本的过程。与训练不同，推理没有"标准答案"，模型需要根据用户输入，一步步地决定下一个最合适的词。让我们跟随"请介绍一下人工智能"这个提示词，体验完整的推理流程。</p>
                
                <!-- 推理演示控制面板 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 mb-8">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                        <div class="flex items-center gap-4">
                            <button id="start-inference-demo" class="bg-[#4338CA] text-white px-4 sm:px-6 py-3 rounded-lg hover:bg-[#3730A3] transition font-semibold min-h-[44px] text-sm sm:text-base">开始推理演示</button>
                            <button id="next-inference-step" class="bg-green-600 text-white px-4 sm:px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold hidden min-h-[44px] text-sm sm:text-base">下一步</button>
                            <button id="reset-inference" class="bg-gray-200 text-gray-800 px-4 sm:px-6 py-3 rounded-lg hover:bg-gray-300 transition font-semibold min-h-[44px] text-sm sm:text-base">重置</button>
                    </div>
                        <div class="flex items-center gap-4">
                            <div class="text-sm text-gray-600">当前阶段:</div>
                            <div id="current-inference-step" class="text-lg font-bold text-[#4338CA]">准备开始</div>
                            </div>
                            </div>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm text-gray-500 mb-2">
                            <span>推理进度</span>
                            <span id="inference-progress-text">0/6</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="inference-progress-bar" class="bg-[#4338CA] h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div id="inference-step-instruction" class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200 hidden">
                        <p class="text-blue-800 text-center">
                            <span class="font-semibold">💡 提示：</span>
                            <span id="inference-instruction-text">点击"开始推理演示"来启动第一步</span>
                        </p>
                    </div>
                </div>
                <!-- 推理步骤展示 -->
                <div class="space-y-8">
                    <!-- 第一步：输入处理与Tokenization -->
                    <div class="inference-step bg-white p-6 rounded-xl shadow-sm border border-gray-200 opacity-50 transition-all duration-500" data-step="1" id="inference-step-1">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第一步：输入处理与分词</h3>
                        <p class="mb-4 text-gray-700">首先将用户输入的文本转换为模型能理解的token序列，并为每个token分配位置编码。</p>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-bold text-blue-700 mb-3">原始输入</h4>
                                <div class="bg-white p-3 rounded border font-mono text-lg">
                                    "请介绍一下人工智能"
                                </div>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-700 mb-3">分词结果</h4>
                                <div class="space-y-2">
                                    <div class="flex flex-wrap gap-2" id="tokenization-display">
                                        <!-- 动态填充分词结果 -->
                                    </div>
                                    <p class="text-xs text-gray-500">总共 8 个tokens</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="inference-step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="1">下一步 →</button>
                        </div>
                    </div>

                    <!-- 第二步：Prefill阶段 -->
                    <div class="inference-step bg-white p-6 rounded-xl shadow-sm border border-gray-200 opacity-50 transition-all duration-500" data-step="2" id="inference-step-2">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第二步：Prefill阶段 - 并行处理输入</h3>
                        <p class="mb-4 text-gray-700">在Prefill阶段，模型并行处理整个输入序列，计算所有token的KV cache，为后续生成做准备。</p>
                        
                        <div class="space-y-6">
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                <h4 class="font-bold text-purple-700 mb-3">🔄 并行注意力计算</h4>
                                <div class="grid grid-cols-4 gap-2 text-xs">
                                    <div class="attention-token bg-white p-2 rounded border text-center opacity-0 transition-all duration-500" data-token="0">
                                        <div class="font-mono">请</div>
                                        <div class="text-purple-600">计算QKV</div>
                                    </div>
                                    <div class="attention-token bg-white p-2 rounded border text-center opacity-0 transition-all duration-500" data-token="1">
                                        <div class="font-mono">介绍</div>
                                        <div class="text-purple-600">计算QKV</div>
                                    </div>
                                    <div class="attention-token bg-white p-2 rounded border text-center opacity-0 transition-all duration-500" data-token="2">
                                        <div class="font-mono">一下</div>
                                        <div class="text-purple-600">计算QKV</div>
                                    </div>
                                    <div class="attention-token bg-white p-2 rounded border text-center opacity-0 transition-all duration-500" data-token="3">
                                        <div class="font-mono">...</div>
                                        <div class="text-purple-600">...</div>
                                    </div>
                                </div>
                                <p class="text-sm text-purple-600 mt-2">所有tokens同时计算，高度并行化</p>
                            </div>
                            
                            <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                <h4 class="font-bold text-orange-700 mb-3">💾 KV Cache构建</h4>
                                <div class="space-y-2" id="kv-cache-build">
                                    <!-- 动态显示KV cache构建过程 -->
                                </div>
                                <p class="text-sm text-orange-600 mt-2">缓存所有input tokens的Key和Value向量</p>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="inference-step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="2">下一步 →</button>
                        </div>
                    </div>

                    <!-- 第三步：Decode阶段 - 第一个token生成 -->
                    <div class="inference-step bg-white p-6 rounded-xl shadow-sm border border-gray-200 opacity-50 transition-all duration-500" data-step="3" id="inference-step-3">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第三步：Decode阶段 - 生成第一个词</h3>
                        <p class="mb-4 text-gray-700">进入自回归生成模式，利用Prefill阶段的KV cache，预测第一个输出token。</p>
                        
                        <div class="space-y-6">
                            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                                <h4 class="font-bold text-indigo-700 mb-3">🎯 注意力计算</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-4">
                                        <div class="bg-white p-2 rounded border">
                                            <div class="text-sm text-gray-600">新位置Query</div>
                                            <div class="font-mono text-xs">[新token的Q向量]</div>
                                        </div>
                                        <div class="text-xl">×</div>
                                        <div class="bg-orange-100 p-2 rounded border">
                                            <div class="text-sm text-gray-600">缓存的Keys</div>
                                            <div class="font-mono text-xs">[所有已知token的K]</div>
                                        </div>
                                        <div class="text-xl">=</div>
                                        <div class="bg-green-100 p-2 rounded border">
                                            <div class="text-sm text-gray-600">注意力权重</div>
                                            <div class="font-mono text-xs">[8个权重值]</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <h4 class="font-bold text-red-700 mb-3">📊 输出概率分布</h4>
                                <div class="space-y-2" id="first-token-probs">
                                    <!-- 动态显示概率分布 -->
                                </div>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-700 mb-3">✨ 第一个生成词</h4>
                                <div class="text-center">
                                    <div class="inline-block bg-white p-4 rounded-lg border-2 border-green-400">
                                        <div class="text-2xl font-mono font-bold" id="first-generated-token">人工智能</div>
                                        <div class="text-sm text-gray-600">基于概率选择</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="inference-step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="3">下一步 →</button>
                        </div>
                    </div>

                    <!-- 第四步：KV Cache更新与后续生成 -->
                    <div class="inference-step bg-white p-6 rounded-xl shadow-sm border border-gray-200 opacity-50 transition-all duration-500" data-step="4" id="inference-step-4">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第四步：KV Cache更新与后续生成</h3>
                        <p class="mb-4 text-gray-700">将新生成的token加入KV Cache，继续自回归生成过程，直到遇到停止条件。</p>
                        
                        <div class="space-y-6">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-bold text-blue-700 mb-3">🔄 Cache增量更新</h4>
                                <div class="space-y-3">
                                    <div class="grid grid-cols-5 gap-2 text-xs">
                                        <div class="bg-orange-100 p-2 rounded border text-center">
                                            <div>原始KV</div>
                                            <div class="font-mono">8 tokens</div>
                                        </div>
                                        <div class="text-xl text-center">+</div>
                                        <div class="bg-green-100 p-2 rounded border text-center">
                                            <div>新token KV</div>
                                            <div class="font-mono">"人工智能"</div>
                                        </div>
                                        <div class="text-xl text-center">=</div>
                                        <div class="bg-purple-100 p-2 rounded border text-center">
                                            <div>更新Cache</div>
                                            <div class="font-mono">9 tokens</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <h4 class="font-bold text-yellow-700 mb-3">🎭 生成进程演示</h4>
                                <div class="space-y-2" id="generation-sequence">
                                    <!-- 动态显示生成序列 -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="inference-step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="4">下一步 →</button>
                        </div>
                    </div>

                    <!-- 第五步：温度和解码策略 -->
                    <div class="inference-step bg-white p-6 rounded-xl shadow-sm border border-gray-200 opacity-50 transition-all duration-500" data-step="5" id="inference-step-5">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第五步：温度与解码策略的影响</h3>
                        <p class="mb-4 text-gray-700">不同的温度和解码策略会显著影响生成结果的质量和创造性。让我们看看同一个输入在不同设置下的表现。</p>
                        
                        <div class="space-y-6">
                            <!-- 温度设置 -->
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <h4 class="font-bold text-red-700 mb-3">🌡️ 温度(Temperature)效果对比</h4>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div class="bg-white p-3 rounded border" id="temp-low">
                                        <div class="font-semibold text-blue-700 mb-2">低温度 (0.2)</div>
                                        <div class="text-sm text-gray-600 mb-2">更确定、保守</div>
                                        <div class="font-mono text-xs bg-blue-50 p-2 rounded">"人工智能是一门..."</div>
                                    </div>
                                    <div class="bg-white p-3 rounded border" id="temp-mid">
                                        <div class="font-semibold text-green-700 mb-2">中温度 (0.7)</div>
                                        <div class="text-sm text-gray-600 mb-2">平衡的选择</div>
                                        <div class="font-mono text-xs bg-green-50 p-2 rounded">"人工智能作为..."</div>
                                    </div>
                                    <div class="bg-white p-3 rounded border" id="temp-high">
                                        <div class="font-semibold text-orange-700 mb-2">高温度 (1.2)</div>
                                        <div class="text-sm text-gray-600 mb-2">更创造、随机</div>
                                        <div class="font-mono text-xs bg-orange-50 p-2 rounded">"人工智能领域..."</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 解码策略 -->
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                                <h4 class="font-bold text-purple-700 mb-3">🎯 解码策略对比</h4>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div class="bg-white p-3 rounded border">
                                        <div class="font-semibold text-purple-700 mb-2">贪心搜索</div>
                                        <div class="text-xs text-gray-600 mb-2">总选概率最高的词</div>
                                        <div class="text-xs">✓ 快速 ✗ 可能重复</div>
                                    </div>
                                    <div class="bg-white p-3 rounded border">
                                        <div class="font-semibold text-purple-700 mb-2">Top-K采样</div>
                                        <div class="text-xs text-gray-600 mb-2">从前K个词中采样</div>
                                        <div class="text-xs">✓ 平衡 ✓ 多样性</div>
                                    </div>
                                    <div class="bg-white p-3 rounded border">
                                        <div class="font-semibold text-purple-700 mb-2">Top-P采样</div>
                                        <div class="text-xs text-gray-600 mb-2">累积概率达到P</div>
                                        <div class="text-xs">✓ 自适应 ✓ 灵活</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="inference-step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="5">下一步 →</button>
                        </div>
                    </div>

                    <!-- 第六步：完整生成结果 -->
                    <div class="inference-step bg-white p-6 rounded-xl shadow-sm border border-gray-200 opacity-50 transition-all duration-500" data-step="6" id="inference-step-6">
                        <h3 class="text-xl sm:text-2xl lg:text-3xl font-semibold mb-4">第六步：完整推理结果</h3>
                        <p class="mb-4 text-gray-700">经过Prefill和多轮Decode，模型完成了从输入提示到完整回答的生成过程。</p>
                        
                        <div class="space-y-6">
                            <div class="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-lg border border-gray-200">
                                <h4 class="font-bold text-gray-700 mb-4 text-center">最终生成结果</h4>
                                <div class="bg-white p-4 rounded border-2 border-green-400">
                                    <div class="font-bold text-gray-700 mb-2">输入：</div>
                                    <div class="font-mono text-blue-600 mb-4">"请介绍一下人工智能"</div>
                                    <div class="font-bold text-gray-700 mb-2">输出：</div>
                                    <div class="font-mono text-green-600" id="final-output">
                                        <!-- 动态显示完整生成结果 -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <h4 class="font-bold text-gray-700 mb-3">📊 推理统计</h4>
                                <div class="grid md:grid-cols-4 gap-4 text-sm">
                                    <div class="text-center">
                                        <div class="font-bold text-blue-600">输入Tokens</div>
                                        <div class="text-xl">8</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-bold text-green-600">输出Tokens</div>
                                        <div class="text-xl">45</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-bold text-purple-600">KV Cache大小</div>
                                        <div class="text-xl">53</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-bold text-orange-600">生成时间</div>
                                        <div class="text-xl">1.2s</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-amber-50 p-4 rounded-lg border border-amber-200">
                                <h4 class="font-bold text-amber-700 mb-3">🎯 核心收获</h4>
                                <ul class="space-y-2 text-sm text-amber-700">
                                    <li>• <strong>Prefill阶段</strong>：并行处理输入，构建KV Cache基础</li>
                                    <li>• <strong>Decode阶段</strong>：自回归生成，增量更新Cache</li>
                                    <li>• <strong>KV Cache</strong>：避免重复计算，大幅提升推理速度</li>
                                    <li>• <strong>温度&解码</strong>：控制生成的确定性和创造性</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button class="inference-step-next-btn bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold hidden" data-step="6">🎉 完成推理演示</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="illusion" class="content-section">
                <h2 class="text-4xl font-bold mb-4 text-[#4338CA]">智能的幻象：为何看起来具有推理能力？</h2>
                <p class="text-xl leading-relaxed mb-6 text-gray-700">现在，我们回到了最初的问题。大模型并不具备人类一样的意识、意图或真正的理解能力。它看起来的"推理能力"，更像是一种<strong>极致的模式模仿</strong>。</p>
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-2xl font-semibold mb-4">推理即模式</h3>
                    <p class="mb-4 text-gray-700">在模型阅读的海量文本中，包含了无数人类进行逻辑推理的过程和模式。当模型被训练去“预测下一个词”时，为了做出最准确的预测，它被迫学习并内化了这些推理过程的形式。</p>
                    <div class="grid md:grid-cols-2 gap-6 mt-6">
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <p class="font-semibold">直接回答 (无思维链)</p>
                            <p class="mt-2 font-mono p-2 bg-gray-100 rounded">Q: 小明有5个苹果，给了小红2个，又买了4个。他现在有几个苹果？<br>A: 7个。</p>
                            <p class="mt-2 text-sm text-gray-600">模型直接输出最可能的结果，像一个“快思考”的系统1。</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                            <p class="font-semibold">引导下的思维链 (Chain-of-Thought)</p>
                            <div id="cot-demo" class="mt-2 font-mono p-2 bg-indigo-100 rounded cursor-pointer">
                                Q: 小明有5个苹果...他现在有几个？<br>
                                <span class="text-indigo-600 font-bold">[点击揭示思考过程]</span>
                            </div>
                            <p class="mt-2 text-sm text-gray-600">通过引导，模型激活了它学到的“分步解决”模式，像一个“慢思考”的系统2。</p>
                        </div>
                    </div>
                </div>
                 <div class="mt-8 text-center p-6 bg-amber-50 rounded-xl border border-amber-200">
                    <p class="text-2xl font-semibold text-amber-900">结论：终极的模仿者</p>
                    <p class="mt-2 text-lg text-amber-800">大模型没有"理解"文字，它只是在更高维度上<strong>掌握了语言的统计结构</strong>。它是一个通过预测下一个词来压缩世界知识的"超级压缩算法"。它所展现出的惊人能力，都源于它在天文数字般的参数中，编码了人类语言和知识中蕴含的复杂模式。</p>
                </div>
            </section>
            </div>
        </main>
    </div>

    <script>
        // 组件选择器功能
        function showComponent(componentName) {
            // 隐藏所有组件详情
            const allDetails = document.querySelectorAll('.component-detail');
            allDetails.forEach(detail => {
                detail.classList.add('hidden');
            });
            
            // 重置所有按钮样式
            const allBtns = document.querySelectorAll('.component-btn');
            allBtns.forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
                if (btn.dataset.component === 'attention') {
                    btn.className = 'component-btn bg-purple-100 hover:bg-purple-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-purple-300 font-semibold text-purple-700 transition min-h-[44px] text-sm sm:text-base';
                } else if (btn.dataset.component === 'ffn') {
                    btn.className = 'component-btn bg-orange-100 hover:bg-orange-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-orange-300 font-semibold text-orange-700 transition min-h-[44px] text-sm sm:text-base';
                } else if (btn.dataset.component === 'moe') {
                    btn.className = 'component-btn bg-green-100 hover:bg-green-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-green-300 font-semibold text-green-700 transition min-h-[44px] text-sm sm:text-base';
                } else if (btn.dataset.component === 'residual') {
                    btn.className = 'component-btn bg-indigo-100 hover:bg-indigo-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-indigo-300 font-semibold text-indigo-700 transition min-h-[44px] text-sm sm:text-base';
                }
            });
            
            // 显示选中的组件
            const targetDetail = document.getElementById(`component-${componentName}`);
            if (targetDetail) {
                targetDetail.classList.remove('hidden');
            }
            
            // 高亮选中的按钮
            const targetBtn = document.querySelector(`[data-component="${componentName}"]`);
            if (targetBtn) {
                if (componentName === 'attention') {
                    targetBtn.className = 'component-btn bg-purple-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-purple-400 font-semibold text-purple-800 ring-2 ring-purple-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                } else if (componentName === 'ffn') {
                    targetBtn.className = 'component-btn bg-orange-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-orange-400 font-semibold text-orange-800 ring-2 ring-orange-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                } else if (componentName === 'moe') {
                    targetBtn.className = 'component-btn bg-green-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-green-400 font-semibold text-green-800 ring-2 ring-green-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                } else if (componentName === 'residual') {
                    targetBtn.className = 'component-btn bg-indigo-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-indigo-400 font-semibold text-indigo-800 ring-2 ring-indigo-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                }
            }
        }

        // 演进阶段控制功能（全局函数）
        function showEvolutionStage(stageName) {
            // 隐藏所有阶段
            const allStages = document.querySelectorAll('.evolution-stage');
            allStages.forEach(stage => {
                stage.classList.add('hidden');
            });
            
            // 重置所有按钮样式
            const allBtns = document.querySelectorAll('.evolution-stage-btn');
            allBtns.forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
                if (btn.dataset.stage === 'rule-based') {
                    btn.className = 'evolution-stage-btn bg-red-100 hover:bg-red-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-red-300 font-semibold text-red-700 transition min-h-[44px] text-sm sm:text-base';
                } else if (btn.dataset.stage === 'statistical') {
                    btn.className = 'evolution-stage-btn bg-orange-100 hover:bg-orange-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-orange-300 font-semibold text-orange-700 transition min-h-[44px] text-sm sm:text-base';
                } else if (btn.dataset.stage === 'neural') {
                    btn.className = 'evolution-stage-btn bg-green-100 hover:bg-green-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-green-300 font-semibold text-green-700 transition min-h-[44px] text-sm sm:text-base';
                } else if (btn.dataset.stage === 'attention') {
                    btn.className = 'evolution-stage-btn bg-blue-100 hover:bg-blue-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-blue-300 font-semibold text-blue-700 transition min-h-[44px] text-sm sm:text-base';
                } else if (btn.dataset.stage === 'transformer') {
                    btn.className = 'evolution-stage-btn bg-purple-100 hover:bg-purple-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-purple-300 font-semibold text-purple-700 transition min-h-[44px] text-sm sm:text-base';
                }
            });
            
            // 显示选中的阶段
            const targetStage = document.getElementById(`stage-${stageName}`);
            if (targetStage) {
                targetStage.classList.remove('hidden');
            }
            
            // 高亮选中的按钮
            const targetBtn = document.querySelector(`[data-stage="${stageName}"]`);
            if (targetBtn) {
                if (stageName === 'rule-based') {
                    targetBtn.className = 'evolution-stage-btn bg-red-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-red-400 font-semibold text-red-800 ring-2 ring-red-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                } else if (stageName === 'statistical') {
                    targetBtn.className = 'evolution-stage-btn bg-orange-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-orange-400 font-semibold text-orange-800 ring-2 ring-orange-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                } else if (stageName === 'neural') {
                    targetBtn.className = 'evolution-stage-btn bg-green-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-green-400 font-semibold text-green-800 ring-2 ring-green-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                } else if (stageName === 'attention') {
                    targetBtn.className = 'evolution-stage-btn bg-blue-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-blue-400 font-semibold text-blue-800 ring-2 ring-blue-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                } else if (stageName === 'transformer') {
                    targetBtn.className = 'evolution-stage-btn bg-purple-200 px-3 sm:px-4 py-3 sm:py-2 rounded-lg border border-purple-400 font-semibold text-purple-800 ring-2 ring-purple-300 ring-offset-2 transition min-h-[44px] text-sm sm:text-base';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');

            function setActiveSection(hash) {
                hash = hash || window.location.hash || '#intro';
                
                navLinks.forEach(link => {
                    if (link.getAttribute('href') === hash) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });

                contentSections.forEach(section => {
                    if ('#' + section.id === hash) {
                        section.classList.add('active');
                    } else {
                        section.classList.remove('active');
                    }
                });
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetHash = this.getAttribute('href');
                    history.pushState(null, null, targetHash);
                    setActiveSection(targetHash);
                    if (window.innerWidth < 768) {
                        sidebar.classList.remove('show');
                    }
                });
            });
            
            window.addEventListener('popstate', () => setActiveSection(window.location.hash));
            
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('show');
            });

            setActiveSection();

            // 初始化演进阶段显示
            showEvolutionStage('rule-based');

            const ctx = document.getElementById('vectorChart').getContext('2d');
            let vectorChart = new Chart(ctx, {
                type: 'scatter', data: { datasets: [] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, position: 'bottom' }, tooltip: { callbacks: { label: function(context) { return context.raw.label; } } } }, scales: { x: { title: { display: true, text: '维度1' } }, y: { title: { display: true, text: '维度2' } } } }
            });

            const relatedData = {
                label: '相关词 (王室与性别)',
                data: [
                    { x: 0.6, y: 0.8, label: '国王' },
                    { x: 0.2, y: 0.85, label: '女王' },
                    { x: 0.55, y: 0.3, label: '男人' },
                    { x: 0.25, y: 0.25, label: '女人' },
                ], backgroundColor: '#4338CA', pointRadius: 8, pointHoverRadius: 12
            };
            const unrelatedData = {
                label: '无关词',
                data: [
                    { x: 0.8, y: 0.9, label: '国王' }, { x: 0.1, y: 0.2, label: '香蕉' }, { x: 0.9, y: 0.1, label: '跑车' }, { x: 0.45, y: 0.6, label: '天空' },
                ], backgroundColor: '#F59E0B', pointRadius: 8, pointHoverRadius: 12
            };

            document.getElementById('plot-related').addEventListener('click', () => { vectorChart.data.datasets = [relatedData]; vectorChart.update(); });
            document.getElementById('plot-unrelated').addEventListener('click', () => { vectorChart.data.datasets = [unrelatedData]; vectorChart.update(); });
            document.getElementById('plot-related').click();

            const attentionWords = document.querySelectorAll('.attention-word');
            const linesContainer = document.getElementById('attention-lines-container');
            const attentionTooltip = document.getElementById('attention-tooltip');
            const attentionWeights = [
                [0.6, 0.2, 0.05, 0.05, 0.05, 0.05], // The -> cat
                [0.2, 0.7, 0.05, 0.0, 0.0, 0.05],  // cat -> The
                [0.1, 0.4, 0.3, 0.1, 0.0, 0.1],   // sat -> cat
                [0.0, 0.1, 0.2, 0.5, 0.1, 0.1],   // on -> sat
                [0.0, 0.05, 0.0, 0.05, 0.6, 0.3], // the -> mat
                [0.05, 0.05, 0.1, 0.2, 0.3, 0.3]  // mat -> the, on
            ];
            
            function clearAttention() {
                linesContainer.innerHTML = '';
                attentionWords.forEach(w => {
                    w.classList.remove('active', 'target');
                    w.style.boxShadow = 'none';
                });
                attentionTooltip.innerHTML = '<p>请悬停体验</p>';
            }

            attentionWords.forEach(word => {
                word.addEventListener('mouseenter', (e) => {
                    clearAttention();
                    const sourceEl = e.target;
                    sourceEl.classList.add('active');
                    const sourceIndex = parseInt(sourceEl.dataset.id);
                    const sourceRect = sourceEl.getBoundingClientRect();
                    const containerRect = linesContainer.getBoundingClientRect();
                    
                    const sourceX = sourceRect.left - containerRect.left + sourceRect.width / 2;
                    const sourceY = sourceRect.top - containerRect.top + sourceRect.height / 2;

                    let tooltipHTML = `<span class="font-bold text-gray-800">${sourceEl.textContent}</span> 关注于: `;
                    let weightedTargets = [];

                    attentionWords.forEach((targetWord, targetIndex) => {
                        const weight = attentionWeights[sourceIndex][targetIndex];
                        if (weight > 0.01) {
                            weightedTargets.push({name: targetWord.textContent, weight: weight});
                            
                            targetWord.classList.add('target');
                            targetWord.style.boxShadow = `0 0 ${weight * 25}px rgba(67, 56, 202, ${weight * 1.5})`;

                            if (sourceIndex !== targetIndex) {
                                const targetRect = targetWord.getBoundingClientRect();
                                const targetX = targetRect.left - containerRect.left + targetRect.width / 2;
                                const targetY = targetRect.top - containerRect.top + targetRect.height / 2;

                                const angle = Math.atan2(targetY - sourceY, targetX - sourceX) * 180 / Math.PI;
                                const distance = Math.sqrt(Math.pow(targetX - sourceX, 2) + Math.pow(targetY - sourceY, 2));
                                
                                const line = document.createElement('div');
                                line.className = 'attention-line';
                                line.style.left = `${sourceX}px`;
                                line.style.top = `${sourceY}px`;
                                line.style.width = `${distance}px`;
                                line.style.transform = `rotate(${angle}deg)`;
                                
                                setTimeout(() => {
                                    line.style.opacity = weight * 1.2;
                                    line.style.height = `${1 + weight * 6}px`;
                                    line.style.borderRadius = '1px';
                                }, 10);

                                linesContainer.appendChild(line);
                            }
                        }
                    });
                    
                    weightedTargets.sort((a, b) => b.weight - a.weight);
                    tooltipHTML += weightedTargets.map(t => `${t.name}(${t.weight.toFixed(2)})`).join(', ');
                    attentionTooltip.innerHTML = tooltipHTML;
                });

                linesContainer.addEventListener('mouseleave', clearAttention);
            });


            const archButtons = document.querySelectorAll('.arch-button');
            const archDisplay = document.getElementById('arch-display');
            const archData = {
                'enc-dec': {
                    title: 'Encoder-Decoder 架构',
                    diagram: `
                        <div class="flex flex-col items-center">
                            <div class="arch-box">输入文本</div>
                            <div class="arch-arrow">↓</div>
                            <div class="arch-diagram w-full md:w-2/3">
                                <div class="arch-box bg-indigo-100 border-indigo-400">Encoder (编码器)</div>
                                <p class="text-center my-2 text-gray-500">理解上下文，生成“思想总结”</p>
                            </div>
                            <div class="arch-arrow">↓</div>
                            <div class="arch-diagram w-full md:w-2/3">
                                <div class="arch-box bg-emerald-100 border-emerald-400">Decoder (解码器)</div>
                                <p class="text-center my-2 text-gray-500">根据“思想总结”，逐词生成</p>
                            </div>
                            <div class="arch-arrow">↓</div>
                            <div class="arch-box">输出文本</div>
                        </div>`,
                    desc: '<strong>核心任务：</strong> 序列到序列 (Seq2Seq)。<br><strong>特点：</strong> 包含完整的编码器和解码器部分，擅长处理输入和输出序列结构不同的任务。<br><strong>典型场景：</strong> 机器翻译、文本摘要。'
                },
                'enc-only': {
                    title: 'Encoder-Only 架构',
                    diagram: `
                        <div class="flex flex-col items-center">
                            <div class="arch-box">输入文本 (部分遮盖)</div>
                            <div class="arch-arrow">↓</div>
                            <div class="arch-diagram w-full md:w-2/3">
                                <div class="arch-box bg-indigo-100 border-indigo-400">Encoder (编码器)</div>
                                <p class="text-center my-2 text-gray-500">深度双向理解上下文</p>
                            </div>
                            <div class="arch-arrow">↓</div>
                            <div class="arch-box">预测被遮盖的词 / 分类</div>
                        </div>`,
                    desc: '<strong>核心任务：</strong> 自然语言理解 (NLU)。<br><strong>特点：</strong> 能够同时看到整个句子的上下文（双向），对文本的理解能力极强。<br><strong>典型场景：</strong> 文本分类、情感分析、命名实体识别 (如BERT)。'
                },
                'dec-only': {
                    title: 'Decoder-Only 架构',
                    diagram: `
                         <div class="flex flex-col items-center">
                            <div class="arch-box">输入文本</div>
                            <div class="arch-arrow">↓</div>
                            <div class="arch-diagram w-full md:w-2/3">
                                <div class="arch-box bg-emerald-100 border-emerald-400">Decoder (解码器)</div>
                                <p class="text-center my-2 text-gray-500">根据上文，预测下一个词</p>
                            </div>
                            <div class="arch-arrow">↓</div>
                            <div class="arch-box">生成的下一个词</div>
                        </div>`,
                    desc: '<strong>核心任务：</strong> 自然语言生成 (NLG)。<br><strong>特点：</strong> 只能看到当前位置之前的文本（单向），天然适合进行自回归式的文本生成。<br><strong>典型场景：</strong> 对话机器人、文章写作、代码补全 (如GPT)。'
                }
            };
            function updateArch(arch) {
                const data = archData[arch];
                archDisplay.innerHTML = `
                    <h4 class="text-2xl font-semibold mb-4 text-center">${data.title}</h4>
                    <div class="grid md:grid-cols-2 gap-8 items-center">
                        <div>${data.diagram}</div>
                        <div class="text-lg leading-relaxed text-gray-700">${data.desc}</div>
                    </div>
                `;
                archButtons.forEach(btn => {
                    if (btn.dataset.arch === arch) {
                        btn.classList.remove('bg-gray-200', 'text-gray-800');
                        btn.classList.add('bg-[#4338CA]', 'text-white');
                    } else {
                        btn.classList.add('bg-gray-200', 'text-gray-800');
                        btn.classList.remove('bg-[#4338CA]', 'text-white');
                    }
                });
            }
            archButtons.forEach(btn => btn.addEventListener('click', () => updateArch(btn.dataset.arch)));
            updateArch('enc-dec');

            const startInferenceBtn = document.getElementById('start-inference');
            const inferenceOutputEl = document.getElementById('inference-output');
            const kvCacheDisplayEl = document.getElementById('kv-cache-display');
            const inferenceTokens = ["中国", "的", "首都", "是"];
            const generatedTokens = ["北", "京", "。"];
            
            if (startInferenceBtn) {
            startInferenceBtn.addEventListener('click', () => {
                startInferenceBtn.disabled = true;
                startInferenceBtn.textContent = '生成中...';
                inferenceOutputEl.innerHTML = inferenceTokens.join(' ');
                kvCacheDisplayEl.innerHTML = '';
                
                let i = 0;
                const prefillInterval = setInterval(() => {
                    if (i < inferenceTokens.length) {
                        const item = document.createElement('div');
                        item.className = 'kv-cache-item';
                        item.textContent = `K/V for "${inferenceTokens[i]}"`;
                        kvCacheDisplayEl.appendChild(item);
                        setTimeout(() => { item.style.opacity = 1; item.style.transform = 'translateX(0)'; }, 10);
                        i++;
                    } else {
                        clearInterval(prefillInterval);
                        startDecoding();
                    }
                }, 400);

                function startDecoding() {
                    let j = 0;
                    const decodeInterval = setInterval(() => {
                        if (j < generatedTokens.length) {
                            inferenceOutputEl.innerHTML += ` <span class="bg-indigo-200">${generatedTokens[j]}</span>`;
                            const item = document.createElement('div');
                            item.className = 'kv-cache-item';
                            item.textContent = `K/V for "${generatedTokens[j]}"`;
                            kvCacheDisplayEl.appendChild(item);
                            setTimeout(() => { item.style.opacity = 1; item.style.transform = 'translateX(0)'; }, 10);
                            j++;
                        } else {
                            clearInterval(decodeInterval);
                            startInferenceBtn.disabled = false;
                            startInferenceBtn.textContent = '重新生成';
                        }
                    }, 800);
                }
            });
            }
            
            const cotDemoEl = document.getElementById('cot-demo');
            cotDemoEl.addEventListener('click', () => {
                cotDemoEl.innerHTML = `
                    Q: 小明有5个苹果，给了小红2个，又买了4个。他现在有几个苹果？<br>
                    <span class="text-gray-600">A: 好的，我们一步一步来分析。<br>
                    1. 小明最初有5个苹果。<br>
                    2. 他给了小红2个，剩下 5 - 2 = 3个。<br>
                    3. 他又买了4个，现在有 3 + 4 = 7个。<br>
                    所以，他现在有7个苹果。</span>
                `;
            });

            // 训练过程演示控制
            const startTrainingBtn = document.getElementById('start-training');
            const nextStepBtn = document.getElementById('next-step');
            const resetTrainingBtn = document.getElementById('reset-training');
            const currentStepEl = document.getElementById('current-step');
            const progressBarEl = document.getElementById('progress-bar');
            const progressTextEl = document.getElementById('progress-text');
            const stepInstructionEl = document.getElementById('step-instruction');
            const instructionTextEl = document.getElementById('instruction-text');
            
            let trainingActive = false;
            let currentTrainingStep = 0;
            let stepCompleted = false;
            
            const trainingSteps = [
                {
                    name: "初始向量",
                    duration: 2000,
                    instruction: "观察词语如何转换为数字向量，每个维度代表不同的语义特征。",
                    nextInstruction: "理解了初始向量后，点击'下一步'看看模型如何进行QKV变换。",
                    animate: () => {
                        const step1 = document.getElementById('step-1');
                        step1.classList.add('active');
                        
                        setTimeout(() => {
                            document.querySelectorAll('#step-1 .vector-bar').forEach(bar => {
                                bar.style.height = bar.style.height;
                            });
                            document.querySelectorAll('#step-1 .vector-animation').forEach(el => {
                                el.classList.add('highlight');
                                setTimeout(() => el.classList.remove('highlight'), 800);
                            });
                        }, 500);
                    }
                },
                {
                    name: "QKV变换",
                    duration: 3000,
                    instruction: "注意力机制的核心：每个词被转换为Query（查询）、Key（键）、Value（值）三个向量。",
                    nextInstruction: "QKV变换完成！接下来看看模型如何计算注意力分数。",
                    animate: () => {
                        const step2 = document.getElementById('step-2');
                        step2.classList.add('active');
                        
                        setTimeout(() => {
                            document.querySelectorAll('#step-2 .transform-arrow').forEach(el => {
                                el.style.opacity = '1';
                            });
                        }, 500);
                        
                        setTimeout(() => {
                            document.querySelectorAll('#step-2 .result-vector').forEach(el => {
                                el.style.opacity = '1';
                                el.style.transform = 'translateY(0)';
                            });
                            
                            // QKV变换动画完成
                        }, 1200);
                    }
                },
                {
                    name: "注意力分数",
                    duration: 3500,
                    instruction: "通过Query和Key的点积运算，计算每个词对当前词的重要性分数。",
                    nextInstruction: "注意力分数计算完毕！下一步将通过Softmax归一化这些分数。",
                    animate: () => {
                        const step3 = document.getElementById('step-3');
                        step3.classList.add('active');
                        
                        setTimeout(() => {
                            document.querySelectorAll('#step-3 .math-element').forEach((el, i) => {
                                setTimeout(() => el.style.opacity = '1', i * 200);
                            });
                        }, 500);
                        
                        setTimeout(() => {
                            document.querySelectorAll('#step-3 .attention-score').forEach(el => {
                                el.style.opacity = '1';
                                el.style.transform = 'scale(1)';
                            });
                            
                            document.querySelectorAll('#step-3 .attention-bar').forEach(bar => {
                                const width = bar.getAttribute('data-width');
                                bar.style.width = width;
                            });
                        }, 1500);
                        
                        setTimeout(() => {
                            document.querySelector('#step-3 .scaling-result').style.opacity = '1';
                            document.querySelector('#step-3 .scaling-result').style.transform = 'translateY(0)';
                        }, 2500);
                    }
                },
                {
                    name: "Softmax归一化",
                    duration: 4000,
                    instruction: "Softmax将原始分数转换为概率分布，确保所有权重加起来等于1。",
                    nextInstruction: "权重分布已确定！现在可以用这些权重来生成上下文向量了。",
                    animate: () => {
                        const step4 = document.getElementById('step-4');
                        step4.classList.add('active');
                        
                        const softmaxSteps = ['softmax-step-1', 'softmax-step-2', 'softmax-step-3', 'softmax-step-4', 'softmax-step-5', 'softmax-result'];
                        softmaxSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                                
                                if (stepId === 'softmax-step-4') {
                                    setTimeout(() => {
                                        document.querySelectorAll('#step-4 .bg-orange-400, #step-4 .bg-green-400').forEach(bar => {
                                            const width = bar.getAttribute('data-width');
                                            bar.style.width = width;
                                        });
                                    }, 500);
                                }
                            }, i * 600);
                        });
                    }
                },
                {
                    name: "生成上下文向量",
                    duration: 3000,
                    instruction: "使用注意力权重对Value向量进行加权求和，生成融合了上下文的新向量。",
                    nextInstruction: "上下文向量生成完毕！最后一步将展示如何进行预测和学习。",
                    animate: () => {
                        const step5 = document.getElementById('step-5');
                        step5.classList.add('active');
                        
                        const computationSteps = ['computation-formula', 'computation-detail', 'computation-result'];
                        computationSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                                
                                // 上下文向量生成完成
                            }, i * 800);
                        });
                    }
                },

                {
                    name: "FFN非线性变换",
                    duration: 3500,
                    instruction: "前馈神经网络进行非线性变换，通过两个线性层和激活函数进一步加工信息。",
                    nextInstruction: "FFN处理完成！现在来详细了解损失函数的计算过程。",
                    animate: () => {
                        const step6 = document.getElementById('step-6');
                        step6.classList.add('active');
                        
                        const ffnSteps = ['ffn-input', 'ffn-linear1', 'ffn-activation', 'ffn-linear2'];
                        ffnSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                            }, i * 600);
                        });
                        
                        const residualSteps = ['residual-add', 'layer-norm'];
                        residualSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                            }, 2400 + i * 600);
                        });
                    }
                },
                {
                    name: "损失函数计算",
                    duration: 3000,
                    instruction: "通过交叉熵损失函数量化预测误差，为梯度计算做准备。",
                    nextInstruction: "损失计算完毕！接下来看看如何通过反向传播计算梯度。",
                    animate: () => {
                        const step7 = document.getElementById('step-7');
                        step7.classList.add('active');
                        
                        const lossSteps = ['loss-prediction', 'loss-formula', 'loss-meaning'];
                        lossSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                            }, i * 800);
                        });
                    }
                },
                {
                    name: "反向传播",
                    duration: 4000,
                    instruction: "通过链式法则计算每个参数的梯度，指导参数更新的方向和幅度。",
                    nextInstruction: "梯度计算完成！最后一步将展示如何使用梯度更新权重。",
                    animate: () => {
                        const step8 = document.getElementById('step-8');
                        step8.classList.add('active');
                        
                        const backpropSteps = ['backprop-output', 'backprop-ffn', 'backprop-attention', 'backprop-weights'];
                        backpropSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                            }, i * 800);
                        });
                    }
                },
                {
                    name: "权重更新优化",
                    duration: 4500,
                    instruction: "使用Adam优化器智能更新W_Q、W_K、W_V三大权重矩阵，完成一个完整的训练循环。",
                    nextInstruction: "🎉 完整训练循环演示完成！你已经深入理解了大模型的完整训练过程。",
                    animate: () => {
                        const step9 = document.getElementById('step-9');
                        step9.classList.add('active');
                        
                        const optimizerSteps = ['adam-gradients', 'adam-correction', 'adam-update'];
                        optimizerSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                            }, i * 800);
                        });
                        
                        const weightSteps = ['update-wq', 'update-wk', 'update-wv'];
                        weightSteps.forEach((stepId, i) => {
                            setTimeout(() => {
                                document.getElementById(stepId).style.opacity = '1';
                            }, 2400 + i * 500);
                        });
                    }
                }
            ];
            

            


            
            function resetTraining() {
                trainingActive = false;
                currentTrainingStep = 0;
                stepCompleted = false;
                currentStepEl.textContent = '准备开始';
                progressBarEl.style.width = '0%';
                progressTextEl.textContent = '0/9';
                
                // 隐藏控制按钮和指导
                nextStepBtn.classList.add('hidden');
                stepInstructionEl.classList.add('hidden');
                startTrainingBtn.classList.remove('hidden');
                
                document.querySelectorAll('.training-step').forEach(step => {
                    step.classList.remove('active', 'completed');
                });
                
                // 重置所有动画元素
                document.querySelectorAll('.vector-bar').forEach(bar => {
                    bar.style.height = '0px';
                });
                document.querySelectorAll('.opacity-0').forEach(el => {
                    el.style.opacity = '0';
                });
                document.querySelectorAll('.transform').forEach(el => {
                    el.style.transform = '';
                });
                document.querySelectorAll('.attention-bar, .bg-orange-400, .bg-green-400, .bg-red-400').forEach(bar => {
                    bar.style.width = '0%';
                });
                
                // 隐藏所有步骤内按钮
                document.querySelectorAll('.step-next-btn').forEach(btn => {
                    btn.classList.add('hidden');
                });
                
                startTrainingBtn.disabled = false;
                startTrainingBtn.textContent = '开始训练演示';
            }
            
            function runCurrentStep() {
                if (currentTrainingStep >= trainingSteps.length) {
                    // 训练完成
                    currentStepEl.textContent = '训练完成！';
                    nextStepBtn.classList.add('hidden');
                    startTrainingBtn.classList.remove('hidden');
                    startTrainingBtn.textContent = '重新开始演示';
                    instructionTextEl.textContent = trainingSteps[trainingSteps.length - 1].nextInstruction;
                    return;
                }
                
                const step = trainingSteps[currentTrainingStep];
                currentStepEl.textContent = step.name;
                progressBarEl.style.width = `${((currentTrainingStep + 1) / trainingSteps.length) * 100}%`;
                progressTextEl.textContent = `${currentTrainingStep + 1}/6`;
                
                // 显示当前步骤说明
                stepInstructionEl.classList.remove('hidden');
                instructionTextEl.textContent = step.instruction;
                
                // 标记前一步为完成状态
                if (currentTrainingStep > 0) {
                    document.getElementById(`step-${currentTrainingStep}`).classList.add('completed');
                }
                
                // 执行当前步骤动画
                step.animate();
                stepCompleted = false;
                
                // 动画完成后允许进入下一步
                setTimeout(() => {
                    stepCompleted = true;
                    if (currentTrainingStep < trainingSteps.length - 1) {
                        instructionTextEl.textContent = step.nextInstruction;
                        nextStepBtn.textContent = '下一步';
                    } else {
                        instructionTextEl.textContent = step.nextInstruction;
                        nextStepBtn.textContent = '完成演示';
                    }
                    
                    // 显示当前步骤内的下一步按钮
                    const stepBtn = document.querySelector(`[data-step="${currentTrainingStep + 1}"].step-next-btn`);
                    if (stepBtn) {
                        stepBtn.classList.remove('hidden');
                    }
                }, step.duration);
            }
            
            function startTraining() {
                trainingActive = true;
                currentTrainingStep = 0;
                
                // 隐藏开始按钮，显示下一步按钮
                startTrainingBtn.classList.add('hidden');
                nextStepBtn.classList.remove('hidden');
                nextStepBtn.textContent = '正在演示...';
                nextStepBtn.disabled = true;
                
                runCurrentStep();
                
                // 第一步完成后启用下一步按钮
                setTimeout(() => {
                    nextStepBtn.disabled = false;
                    if (currentTrainingStep < trainingSteps.length - 1) {
                        nextStepBtn.textContent = '下一步';
                    } else {
                        nextStepBtn.textContent = '完成演示';
                    }
                    
                    // 显示第一步内的下一步按钮
                    const stepBtn = document.querySelector(`[data-step="1"].step-next-btn`);
                    if (stepBtn) {
                        stepBtn.classList.remove('hidden');
                    }
                }, trainingSteps[0].duration);
            }
            
            function nextStep() {
                if (!stepCompleted) return;
                
                currentTrainingStep++;
                nextStepBtn.disabled = true;
                nextStepBtn.textContent = '正在演示...';
                
                if (currentTrainingStep >= trainingSteps.length) {
                    // 演示完成
                    resetTraining();
                    return;
                }
                
                runCurrentStep();
                
                // 当前步骤完成后重新启用按钮
                setTimeout(() => {
                    if (currentTrainingStep < trainingSteps.length) {
                        nextStepBtn.disabled = false;
                        if (currentTrainingStep < trainingSteps.length - 1) {
                            nextStepBtn.textContent = '下一步';
                        } else {
                            nextStepBtn.textContent = '完成演示';
                        }
                    }
                }, trainingSteps[currentTrainingStep].duration);
            }
            
            if (startTrainingBtn) {
            startTrainingBtn.addEventListener('click', () => {
                if (!trainingActive) {
                    startTraining();
                } else {
                    resetTraining();
                }
            });
            }
            
            nextStepBtn.addEventListener('click', nextStep);
            resetTrainingBtn.addEventListener('click', resetTraining);
            
            // 处理每个步骤内的下一步按钮
            document.querySelectorAll('.step-next-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const stepNum = parseInt(btn.getAttribute('data-step'));
                    if (stepNum === 9) {
                        // 最后一步，重置演示
                        resetTraining();
                    } else {
                        // 调用主控制器的下一步函数
                        nextStep();
                    }
                });
            });
            
            // 推理演示相关变量和逻辑
            let inferenceActive = false;
            let currentInferenceStep = 0;
            let inferenceStepCompleted = false;
            
            const startInferenceDemoBtn = document.getElementById('start-inference-demo');
            const nextInferenceStepBtn = document.getElementById('next-inference-step');
            const resetInferenceBtn = document.getElementById('reset-inference');
            const currentInferenceStepEl = document.getElementById('current-inference-step');
            const inferenceProgressBarEl = document.getElementById('inference-progress-bar');
            const inferenceProgressTextEl = document.getElementById('inference-progress-text');
            const inferenceStepInstructionEl = document.getElementById('inference-step-instruction');
            const inferenceInstructionTextEl = document.getElementById('inference-instruction-text');
            
            const inferenceSteps = [
                {
                    name: "输入处理与分词",
                    duration: 2500,
                    instruction: "观察用户输入如何被分解为tokens，每个token都有唯一的ID和位置编码。",
                    nextInstruction: "分词完成！点击'下一步'进入Prefill阶段，看看模型如何并行处理输入。",
                    animate: () => {
                        const step1 = document.getElementById('inference-step-1');
                        step1.classList.add('active');
                        step1.style.opacity = '1';
                        
                        const tokens = ['请', '介绍', '一下', '人工', '智能'];
                        const tokenDisplay = document.getElementById('tokenization-display');
                        tokenDisplay.innerHTML = '';
                        
                        tokens.forEach((token, i) => {
                            setTimeout(() => {
                                const tokenEl = document.createElement('div');
                                tokenEl.className = 'bg-blue-100 border border-blue-300 px-2 py-1 rounded font-mono text-sm';
                                tokenEl.textContent = token;
                                tokenDisplay.appendChild(tokenEl);
                            }, i * 300);
                        });
                    }
                },
                {
                    name: "Prefill阶段",
                    duration: 3500,
                    instruction: "模型并行处理所有输入tokens，为每个位置计算QKV向量，构建KV Cache基础。",
                    nextInstruction: "Prefill完成！所有输入的KV已缓存。点击'下一步'开始第一轮Decode生成。",
                    animate: () => {
                        const step2 = document.getElementById('inference-step-2');
                        step2.classList.add('active');
                        step2.style.opacity = '1';
                        
                        const attentionTokens = document.querySelectorAll('.attention-token');
                        attentionTokens.forEach((token, i) => {
                            setTimeout(() => {
                                token.style.opacity = '1';
                                token.style.transform = 'scale(1.05)';
                                setTimeout(() => {
                                    token.style.transform = 'scale(1)';
                                }, 200);
                            }, i * 400);
                        });
                        
                        const kvCacheBuild = document.getElementById('kv-cache-build');
                        setTimeout(() => {
                            kvCacheBuild.innerHTML = `
                                <div class="bg-white p-2 rounded border text-sm">
                                    <div class="font-mono text-xs">K_cache: [请][介绍][一下][人工][智能]</div>
                                    <div class="font-mono text-xs mt-1">V_cache: [请][介绍][一下][人工][智能]</div>
                                </div>
                            `;
                        }, 1500);
                    }
                },
                {
                    name: "第一轮Decode生成",
                    duration: 3000,
                    instruction: "利用缓存的KV，计算新位置的注意力权重，生成第一个输出token。",
                    nextInstruction: "首个token '人工智能' 生成完成！点击'下一步'看看KV Cache如何增量更新。",
                    animate: () => {
                        const step3 = document.getElementById('inference-step-3');
                        step3.classList.add('active');
                        step3.style.opacity = '1';
                        
                        const probsDisplay = document.getElementById('first-token-probs');
                        setTimeout(() => {
                            probsDisplay.innerHTML = `
                                <div class="grid grid-cols-2 gap-2 text-xs">
                                    <div class="bg-white p-2 rounded border">
                                        <span class="font-mono">"人工智能"</span>
                                        <div class="w-full bg-gray-200 rounded">
                                            <div class="bg-green-400 h-2 rounded" style="width: 45%"></div>
                                        </div>
                                        <span class="text-green-600">45%</span>
                                    </div>
                                    <div class="bg-white p-2 rounded border">
                                        <span class="font-mono">"AI"</span>
                                        <div class="w-full bg-gray-200 rounded">
                                            <div class="bg-blue-400 h-2 rounded" style="width: 25%"></div>
                                        </div>
                                        <span class="text-blue-600">25%</span>
                                    </div>
                                </div>
                            `;
                        }, 1000);
                        
                        setTimeout(() => {
                            document.getElementById('first-generated-token').style.transform = 'scale(1.1)';
                            setTimeout(() => {
                                document.getElementById('first-generated-token').style.transform = 'scale(1)';
                            }, 500);
                        }, 2000);
                    }
                },
                {
                    name: "KV Cache更新",
                    duration: 3000,
                    instruction: "将新生成的token加入KV Cache，继续自回归生成，逐步构建完整回答。",
                    nextInstruction: "Cache更新完成！点击'下一步'了解温度和解码策略如何影响生成结果。",
                    animate: () => {
                        const step4 = document.getElementById('inference-step-4');
                        step4.classList.add('active');
                        step4.style.opacity = '1';
                        
                        const generationSeq = document.getElementById('generation-sequence');
                        const sequence = [
                            '人工智能是一门',
                            '人工智能是一门综合性',
                            '人工智能是一门综合性的',
                            '人工智能是一门综合性的学科'
                        ];
                        
                        sequence.forEach((text, i) => {
                            setTimeout(() => {
                                const seqEl = document.createElement('div');
                                seqEl.className = 'bg-white p-2 rounded border font-mono text-sm';
                                seqEl.textContent = `输出 ${i+1}: "${text}"`;
                                generationSeq.appendChild(seqEl);
                            }, i * 600);
                        });
                    }
                },
                {
                    name: "温度与解码策略",
                    duration: 3500,
                    instruction: "不同的温度和解码策略会产生不同风格的文本：保守、平衡或创造性。",
                    nextInstruction: "策略对比展示完成！点击'下一步'查看完整的推理结果和统计信息。",
                    animate: () => {
                        const step5 = document.getElementById('inference-step-5');
                        step5.classList.add('active');
                        step5.style.opacity = '1';
                        
                        const tempExamples = [
                            { id: 'temp-low', text: '人工智能是一门研究如何让计算机模拟人类智能的学科...' },
                            { id: 'temp-mid', text: '人工智能作为现代科技的重要分支，致力于开发智能系统...' },
                            { id: 'temp-high', text: '人工智能领域正在以前所未有的速度革新着我们的世界...' }
                        ];
                        
                        tempExamples.forEach((example, i) => {
                            setTimeout(() => {
                                const el = document.getElementById(example.id);
                                const textEl = el.querySelector('.font-mono');
                                textEl.textContent = `"${example.text}"`;
                                el.style.transform = 'scale(1.02)';
                                setTimeout(() => {
                                    el.style.transform = 'scale(1)';
                                }, 300);
                            }, i * 500);
                        });
                    }
                },
                {
                    name: "完整推理结果",
                    duration: 4000,
                    instruction: "展示从输入到输出的完整推理过程，包括性能统计和核心技术要点。",
                    nextInstruction: "🎉 推理演示完成！你已经深入了解了大模型从输入到输出的完整生成过程。",
                    animate: () => {
                        const step6 = document.getElementById('inference-step-6');
                        step6.classList.add('active');
                        step6.style.opacity = '1';
                        
                        const finalOutput = document.getElementById('final-output');
                        const fullResponse = `人工智能是一门综合性的学科，它研究如何让计算机系统能够模拟、延伸和扩展人类的智能。AI涵盖了机器学习、深度学习、自然语言处理、计算机视觉等多个技术领域，目标是创建能够感知、理解、学习和决策的智能系统。`;
                        
                        setTimeout(() => {
                            let i = 0;
                            const typeWriter = setInterval(() => {
                                finalOutput.textContent = fullResponse.substring(0, i);
                                i++;
                                if (i > fullResponse.length) {
                                    clearInterval(typeWriter);
                                }
                            }, 30);
                        }, 1000);
                    }
                }
            ];
            
            function resetInference() {
                inferenceActive = false;
                currentInferenceStep = 0;
                inferenceStepCompleted = false;
                if (currentInferenceStepEl) currentInferenceStepEl.textContent = '准备开始';
                if (inferenceProgressBarEl) inferenceProgressBarEl.style.width = '0%';
                if (inferenceProgressTextEl) inferenceProgressTextEl.textContent = '0/6';
                
                if (nextInferenceStepBtn) nextInferenceStepBtn.classList.add('hidden');
                if (inferenceStepInstructionEl) inferenceStepInstructionEl.classList.add('hidden');
                if (startInferenceDemoBtn) startInferenceDemoBtn.classList.remove('hidden');
                
                document.querySelectorAll('.inference-step').forEach(step => {
                    step.classList.remove('active');
                    step.style.opacity = '0.5';
                });
                
                document.querySelectorAll('.inference-step-next-btn').forEach(btn => {
                    btn.classList.add('hidden');
                });
                
                // 清空动态内容
                const tokenDisplay = document.getElementById('tokenization-display');
                const kvCacheBuild = document.getElementById('kv-cache-build');
                const probsDisplay = document.getElementById('first-token-probs');
                const generationSeq = document.getElementById('generation-sequence');
                const finalOutput = document.getElementById('final-output');
                
                if (tokenDisplay) tokenDisplay.innerHTML = '';
                if (kvCacheBuild) kvCacheBuild.innerHTML = '';
                if (probsDisplay) probsDisplay.innerHTML = '';
                if (generationSeq) generationSeq.innerHTML = '';
                if (finalOutput) finalOutput.textContent = '';
            }
            
            function runCurrentInferenceStep() {
                if (currentInferenceStep >= inferenceSteps.length) return;
                
                const step = inferenceSteps[currentInferenceStep];
                if (currentInferenceStepEl) currentInferenceStepEl.textContent = step.name;
                
                const progress = ((currentInferenceStep + 1) / inferenceSteps.length) * 100;
                if (inferenceProgressBarEl) inferenceProgressBarEl.style.width = progress + '%';
                if (inferenceProgressTextEl) inferenceProgressTextEl.textContent = `${currentInferenceStep + 1}/6`;
                
                if (inferenceInstructionTextEl) inferenceInstructionTextEl.textContent = step.instruction;
                if (inferenceStepInstructionEl) inferenceStepInstructionEl.classList.remove('hidden');
                
                // 隐藏所有步骤级别的下一步按钮
                document.querySelectorAll('.inference-step-next-btn').forEach(btn => {
                    btn.classList.add('hidden');
                });
                
                step.animate();
                
                setTimeout(() => {
                    inferenceStepCompleted = true;
                    if (inferenceInstructionTextEl) inferenceInstructionTextEl.textContent = step.nextInstruction;
                    
                    if (currentInferenceStep < inferenceSteps.length - 1) {
                        if (nextInferenceStepBtn) nextInferenceStepBtn.classList.remove('hidden');
                        
                        // 显示对应步骤的下一步按钮
                        const stepBtn = document.querySelector(`[data-step="${currentInferenceStep + 1}"].inference-step-next-btn`);
                        if (stepBtn) {
                            stepBtn.classList.remove('hidden');
                        }
                    } else {
                        const lastStepBtn = document.querySelector(`[data-step="${currentInferenceStep + 1}"].inference-step-next-btn`);
                        if (lastStepBtn) {
                            lastStepBtn.classList.remove('hidden');
                        }
                    }
                }, step.duration);
            }
            
            function startInferenceDemo() {
                inferenceActive = true;
                currentInferenceStep = 0;
                inferenceStepCompleted = false;
                if (startInferenceDemoBtn) startInferenceDemoBtn.classList.add('hidden');
                if (nextInferenceStepBtn) nextInferenceStepBtn.classList.remove('hidden');
                runCurrentInferenceStep();
            }
            
            function nextInferenceStep() {
                if (!inferenceStepCompleted) return;
                
                if (nextInferenceStepBtn) nextInferenceStepBtn.disabled = true;
                currentInferenceStep++;
                inferenceStepCompleted = false;
                
                if (currentInferenceStep >= inferenceSteps.length) {
                    inferenceActive = false;
                    if (nextInferenceStepBtn) nextInferenceStepBtn.classList.add('hidden');
                    return;
                }
                
                runCurrentInferenceStep();
                
                setTimeout(() => {
                    if (nextInferenceStepBtn) nextInferenceStepBtn.disabled = false;
                }, 500);
            }
            
            // 推理演示事件监听器
            if (startInferenceDemoBtn) {
                startInferenceDemoBtn.addEventListener('click', startInferenceDemo);
            }
            
            if (nextInferenceStepBtn) {
                nextInferenceStepBtn.addEventListener('click', nextInferenceStep);
            }
            
            if (resetInferenceBtn) {
                resetInferenceBtn.addEventListener('click', resetInference);
            }
            
            // 推理步骤级别的下一步按钮
            document.querySelectorAll('.inference-step-next-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.textContent.includes('完成')) {
                        resetInference();
                    } else {
                        nextInferenceStep();
                    }
                });
            });

        });
    </script>
</body>
</html>
